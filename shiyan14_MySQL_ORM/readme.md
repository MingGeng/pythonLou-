<div><h1 id="-mysql-orm">关系数据库 MySQL 和 ORM</h1>
<h2 id="labdoc-header-0">简介</h2>
<p>Web开发中，离不开数据库的支持，在本节实验中我们将学习关系数据库 MySQL 和 ORM SQLAlchemy。<a href="https://www.mysql.com/" target="_blank">MySQL</a> 是应用最广泛的数据库，而 <a href="https://www.sqlalchemy.org/" target="_blank">SQLAlchemy</a> 是 Python 语言中最流行的 ORM。</p><h3 id="labdoc-header-1">知识点</h3>
<ul>
<li>MySQL 基础知识</li>
<li>关系数据库基础</li>
<li>SQLAlchemy 基础知识</li>
</ul>
<h2 id="labdoc-header-2">MySQL</h2>
<p>MySQL 是应用最广泛的关系数据库。关系数据库使用关系模型作为数据组织存储的方式，可以分为四级结构：</p><ul>
<li>数据库，比如一个应用对应一个数据库；</li>
<li>表，一个数据库包含若干张表；</li>
<li>记录，一个表包含多条记录；</li>
<li>字段，一条记录包含若干字段；</li>
</ul>
<p>一张表的结构可以想象成一张 Excel 表，由多个字段组成，每一个字段都可以存储特定类型的数据，比如字符串或者数字，在创建表的时候可以指定类型。表与表之间通过关系连接（逻辑上的关系），查询数据时可以通过关系跨越多张表进行查询。</p><p>关系数据库最重要的特性是满足 ACID 性质：</p><ul>
<li>A atomicity 代表原子性；</li>
<li>C consistency 代表一致性；</li>
<li>I isolation 代表隔离性；</li>
<li>D durability 代表持久性；</li>
</ul>
<p>ACID 能够保证事务的可靠性，什么意思呢？就是说能够保证一系列的数据库操作组成的一个完整逻辑过程，要么全部被执行，要么彻底不执行，不会出现执行一半的情况。例如银行转帐，从原账户扣除金额，以及向目标账户添加金额，这两个数据库操作的总和，构成一个完整的逻辑过程，不可拆分。</p><p>为了满足 ACID 性质，MySQL 支持各种约束，比如插入一条数据时，需要检查外键是否存在，这些操作虽然能确保数据的一致性，但是很多时候却降低了并发操作的能力，所以在如今的互联网网站中，如果有高并发的需求往往不再使用关系数据库的 ACID 性质，更有的直接使用非关系数据库。</p><p>除此之外，这里再补充几点关系数据库中关系键的基本概念知识，以帮助理解下文内容。</p><ul>
<li><strong>主键</strong>（英语：primary key）。数据库表中对储存数据对象予以唯一和完整标识的数据列或属性的组合。一个数据列只能有一个主键，且主键的取值不能缺失，即不能为空值（Null）。</li>
<li><strong>外键</strong>（英语：foreign key）。其实在关系数据库中，每个数据表都是由关系来连系彼此的关系，父数据表（Parent Entity）的主键（primary key）会放在另一个数据表，当做属性以创建彼此的关系，而这个属性就是外键。</li>
</ul>
<blockquote>
<p>比如，学生跟老师之间对应着教学关系，学生数据表会有个属性叫指导老师（外键），而这个值就是对应到老师数据表的老师代号（主键）。</p></blockquote>
<p>在接下来的内容中，我们将学习基本的 MySQL 操作。</p><h3 id="labdoc-header-3">环境准备</h3>
<p>实验楼环境中已经安装了 MySQL 数据库软件，每次启动实验后，需要手动启动 MySQL 服务。在实验桌面上启动终端后，通过以下命令启动数据库：</p><pre><code class="hljs ruby">$ sudo<span class="hljs-built_in"> service </span>mysql start
</code></pre><p>还需要安装一个包</p><pre><code class="hljs ruby"><span class="hljs-meta">$</span><span class="bash"> sudo pip3 install mysqlclient</span>
</code></pre><p>这个包的作用是让 Python 可以连接 MySQL 数据库，如果不安装使用 Python 及 SQLAlchemy 连接 MySQL 数据库的时候则会出现下面的错误：</p><pre><code class="hljs ruby"><span class="hljs-attr"><span class="hljs-symbol">ImportError:</span></span> <span class="hljs-literal">No</span> <span class="hljs-string"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-string"><span class="hljs-class"><span class="hljs-title">named</span></span></span><span class="hljs-class"> </span><span class="hljs-string"><span class="hljs-class"><span class="hljs-title">MySQLdb</span></span></span>
</code></pre><p>或者</p><pre><code class="hljs coffeescript"><span class="hljs-keyword">Module</span> MySQLdb <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found
</code></pre><p>这类的错误，原因就是在实验环境中没有安装 mysqlclient，或者你在使用 virtualenv（下面Python连接数据库部分会学习到） 的时候没有在虚拟环境中安装这个包（也有可能安装了，但没有重新激活 virtualenv 环境也会造成这个错误）。</p><p>如果这个错误出现在用 virtualenv（虚拟环境） 创建的虚拟环境里，需要在 virtualenv 中执行 <code>pip3 install mysqlclient</code>，然后执行 deactivate 退出虚拟环境再进到 virtualenv 就可以解决。</p><p>如果没用 virtualenv 创建虚拟环境，报这个错执行 <code>sudo pip3 install mysqlclient</code> 即可。</p><p>virtualenv（虚拟环境）的作用是避免 python 版本和软件包版本的使用冲突，例如系统环境里只安装了 python3.5 ，而某程序需要运行在 python2.7 上，或者不同程序用到软件包的不同版本，都可以用 virtualenv 来解决，在 virtualenv 中安装一些 Python 软件包，需要重新进入 virtualenv 环境才能生效。</p><p>数据库启动成功以后，通过以下命令链接到数据库：</p><pre><code class="hljs ruby"><span class="hljs-meta">$</span><span class="bash"> mysql -u root</span>
</code></pre><p>MySQL 数据库由服务器端和客户端组成，可以通过客户端连接到服务器。以上命令中，使用 <code>root</code> 账户登陆服务器，<code>root</code> 账户是 MySQL 数据库的超级管理员账户，未指定密码信息，这是因为实验楼环境中未设置 <code>root</code> 账户的密码。 登录成功后如下图所示：</p><p><img src="https://dn-anything-about-doc.qbox.me/document-uid5348labid2994timestamp1504072728038.png/wm" alt="此处输入图片的描述"></p><p>后面的所有 MySQL 命令都通过 MySQL 客户端输入(也就是以 <code>mysql&gt;</code> 标识符开始的命令)。</p><p>MySQL 环境操作视频：</p><p><div tabindex="-1" id="vjs_video_3" data-setup="{&quot;fluid&quot;:true}" preload="auto" class="video-js vjs-default-skin vjs-paused vjs-fluid vjs_video_3-dimensions vjs-controls-enabled vjs-workinghover vjs-v6 vjs-user-inactive" lang="zh-cn" role="region" aria-label="Video Player"><video class="vjs-tech" preload="auto" data-setup="{&quot;fluid&quot;:true}" id="vjs_video_3_html5_api" tabindex="-1"><source src="https://labfile.oss.aliyuncs.com/courses/923/week2_mp4/2-2-1-mac.mp4" type="video/mp4"></video><div class="vjs-poster vjs-hidden" tabindex="-1" aria-disabled="false"></div><div class="vjs-text-track-display" aria-live="off" aria-atomic="true"></div><div class="vjs-loading-spinner" dir="ltr"></div><button class="vjs-big-play-button" type="button" aria-live="polite" title="Play Video" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Play Video</span></button><div class="vjs-control-bar" dir="ltr" role="group"><button class="vjs-play-control vjs-control vjs-button" type="button" aria-live="polite" title="Play" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Play</span></button><div class="vjs-volume-panel vjs-control vjs-volume-panel-horizontal"><button class="vjs-mute-control vjs-control vjs-button vjs-vol-3" type="button" aria-live="polite" title="Mute" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Mute</span></button><div class="vjs-volume-control vjs-control vjs-volume-horizontal"><div tabindex="0" class="vjs-volume-bar vjs-slider-bar vjs-slider vjs-slider-horizontal" role="slider" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" aria-label="Volume Level" aria-live="polite" aria-valuetext="100%"><div class="vjs-volume-level"><span class="vjs-control-text"></span></div></div></div></div><div class="vjs-current-time vjs-time-control vjs-control"><div class="vjs-current-time-display" aria-live="off"><span class="vjs-control-text">Current Time</span> 0:00</div></div><div class="vjs-time-control vjs-time-divider"><div><span>/</span></div></div><div class="vjs-duration vjs-time-control vjs-control"><div class="vjs-duration-display" aria-live="off"><span class="vjs-control-text">Duration Time</span> 0:39</div></div><div class="vjs-progress-control vjs-control"><div tabindex="0" class="vjs-progress-holder vjs-slider vjs-slider-horizontal" role="slider" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Progress Bar"><div class="vjs-load-progress" style="width: 0%;"><span class="vjs-control-text"><span>Loaded</span>: 0%</span><div style="left: 0%; width: 0%;"></div></div><div class="vjs-mouse-display"><div class="vjs-time-tooltip"></div></div><div class="vjs-play-progress vjs-slider-bar"><div class="vjs-time-tooltip"></div><span class="vjs-control-text"><span>Progress</span>: 0%</span></div></div></div><div class="vjs-live-control vjs-control vjs-hidden"><div class="vjs-live-display" aria-live="off"><span class="vjs-control-text">Stream Type</span>LIVE</div></div><div class="vjs-remaining-time vjs-time-control vjs-control"><div class="vjs-remaining-time-display" aria-live="off"><span class="vjs-control-text">Remaining Time</span> -0:39</div></div><div class="vjs-custom-control-spacer vjs-spacer ">&nbsp;</div><div class="vjs-playback-rate vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-playback-rate vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Playback Rate" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Playback Rate</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"></ul></div><div class="vjs-playback-rate-value">1x</div></div><div class="vjs-chapters-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-chapters-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Chapters" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Chapters</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-title" tabindex="-1">Chapters</li></ul></div></div><div class="vjs-descriptions-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-descriptions-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Descriptions" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Descriptions</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-item vjs-selected" tabindex="-1" role="menuitemcheckbox" aria-live="polite" aria-disabled="false" aria-checked="true"><span class="vjs-menu-item-text">descriptions off</span><span class="vjs-control-text">, selected</span></li></ul></div></div><div class="vjs-subs-caps-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-subs-caps-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Subtitles" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Subtitles</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-item vjs-texttrack-settings" tabindex="-1" role="menuitem" aria-live="polite" aria-disabled="false"><span class="vjs-menu-item-text">subtitles settings</span><span class="vjs-control-text">, opens subtitles settings dialog</span></li><li class="vjs-menu-item vjs-selected" tabindex="-1" role="menuitemcheckbox" aria-live="polite" aria-disabled="false" aria-checked="true"><span class="vjs-menu-item-text">subtitles off</span><span class="vjs-control-text">, selected</span></li></ul></div></div><div class="vjs-audio-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-audio-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Audio Track" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Audio Track</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"></ul></div></div><button class="vjs-fullscreen-control vjs-control vjs-button" type="button" aria-live="polite" title="Fullscreen" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Fullscreen</span></button></div><div class="vjs-error-display vjs-modal-dialog vjs-hidden " tabindex="-1" aria-describedby="vjs_video_3_component_368_description" aria-hidden="true" aria-label="Modal Window" role="dialog"><p class="vjs-modal-dialog-description vjs-control-text" id="vjs_video_3_component_368_description">This is a modal window.</p><div class="vjs-modal-dialog-content" role="document"></div></div><div class="vjs-modal-dialog vjs-hidden  vjs-text-track-settings" tabindex="-1" aria-describedby="vjs_video_3_component_374_description" aria-hidden="true" aria-label="Caption Settings Dialog" role="dialog"><p class="vjs-modal-dialog-description vjs-control-text" id="vjs_video_3_component_374_description">Beginning of dialog window. Escape will cancel and close the window.</p><div class="vjs-modal-dialog-content" role="document"><div class="vjs-track-settings-colors"><fieldset class="vjs-fg-color vjs-track-setting"><legend id="captions-text-legend-vjs_video_3_component_374">Text</legend><label id="captions-foreground-color-vjs_video_3_component_374" class="vjs-label">Color</label><select aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374"><option id="captions-foreground-color-vjs_video_3_component_374-White" value="#FFF" aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374-White">White</option><option id="captions-foreground-color-vjs_video_3_component_374-Black" value="#000" aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374-Black">Black</option><option id="captions-foreground-color-vjs_video_3_component_374-Red" value="#F00" aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374-Red">Red</option><option id="captions-foreground-color-vjs_video_3_component_374-Green" value="#0F0" aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374-Green">Green</option><option id="captions-foreground-color-vjs_video_3_component_374-Blue" value="#00F" aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374-Blue">Blue</option><option id="captions-foreground-color-vjs_video_3_component_374-Yellow" value="#FF0" aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374-Yellow">Yellow</option><option id="captions-foreground-color-vjs_video_3_component_374-Magenta" value="#F0F" aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374-Magenta">Magenta</option><option id="captions-foreground-color-vjs_video_3_component_374-Cyan" value="#0FF" aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374 captions-foreground-color-vjs_video_3_component_374-Cyan">Cyan</option></select><span class="vjs-text-opacity vjs-opacity"><label id="captions-foreground-opacity-vjs_video_3_component_374" class="vjs-label">Transparency</label><select aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-opacity-vjs_video_3_component_374"><option id="captions-foreground-opacity-vjs_video_3_component_374-Opaque" value="1" aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-opacity-vjs_video_3_component_374 captions-foreground-opacity-vjs_video_3_component_374-Opaque">Opaque</option><option id="captions-foreground-opacity-vjs_video_3_component_374-Semi-Transparent" value="0.5" aria-labelledby="captions-text-legend-vjs_video_3_component_374 captions-foreground-opacity-vjs_video_3_component_374 captions-foreground-opacity-vjs_video_3_component_374-Semi-Transparent">Semi-Transparent</option></select></span></fieldset><fieldset class="vjs-bg-color vjs-track-setting"><legend id="captions-background-vjs_video_3_component_374">Background</legend><label id="captions-background-color-vjs_video_3_component_374" class="vjs-label">Color</label><select aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374"><option id="captions-background-color-vjs_video_3_component_374-Black" value="#000" aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374-Black">Black</option><option id="captions-background-color-vjs_video_3_component_374-White" value="#FFF" aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374-White">White</option><option id="captions-background-color-vjs_video_3_component_374-Red" value="#F00" aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374-Red">Red</option><option id="captions-background-color-vjs_video_3_component_374-Green" value="#0F0" aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374-Green">Green</option><option id="captions-background-color-vjs_video_3_component_374-Blue" value="#00F" aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374-Blue">Blue</option><option id="captions-background-color-vjs_video_3_component_374-Yellow" value="#FF0" aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374-Yellow">Yellow</option><option id="captions-background-color-vjs_video_3_component_374-Magenta" value="#F0F" aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374-Magenta">Magenta</option><option id="captions-background-color-vjs_video_3_component_374-Cyan" value="#0FF" aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374 captions-background-color-vjs_video_3_component_374-Cyan">Cyan</option></select><span class="vjs-bg-opacity vjs-opacity"><label id="captions-background-opacity-vjs_video_3_component_374" class="vjs-label">Transparency</label><select aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-opacity-vjs_video_3_component_374"><option id="captions-background-opacity-vjs_video_3_component_374-Opaque" value="1" aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-opacity-vjs_video_3_component_374 captions-background-opacity-vjs_video_3_component_374-Opaque">Opaque</option><option id="captions-background-opacity-vjs_video_3_component_374-Semi-Transparent" value="0.5" aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-opacity-vjs_video_3_component_374 captions-background-opacity-vjs_video_3_component_374-Semi-Transparent">Semi-Transparent</option><option id="captions-background-opacity-vjs_video_3_component_374-Transparent" value="0" aria-labelledby="captions-background-vjs_video_3_component_374 captions-background-opacity-vjs_video_3_component_374 captions-background-opacity-vjs_video_3_component_374-Transparent">Transparent</option></select></span></fieldset><fieldset class="vjs-window-color vjs-track-setting"><legend id="captions-window-vjs_video_3_component_374">Window</legend><label id="captions-window-color-vjs_video_3_component_374" class="vjs-label">Color</label><select aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374"><option id="captions-window-color-vjs_video_3_component_374-Black" value="#000" aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374-Black">Black</option><option id="captions-window-color-vjs_video_3_component_374-White" value="#FFF" aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374-White">White</option><option id="captions-window-color-vjs_video_3_component_374-Red" value="#F00" aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374-Red">Red</option><option id="captions-window-color-vjs_video_3_component_374-Green" value="#0F0" aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374-Green">Green</option><option id="captions-window-color-vjs_video_3_component_374-Blue" value="#00F" aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374-Blue">Blue</option><option id="captions-window-color-vjs_video_3_component_374-Yellow" value="#FF0" aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374-Yellow">Yellow</option><option id="captions-window-color-vjs_video_3_component_374-Magenta" value="#F0F" aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374-Magenta">Magenta</option><option id="captions-window-color-vjs_video_3_component_374-Cyan" value="#0FF" aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374 captions-window-color-vjs_video_3_component_374-Cyan">Cyan</option></select><span class="vjs-window-opacity vjs-opacity"><label id="captions-window-opacity-vjs_video_3_component_374" class="vjs-label">Transparency</label><select aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-opacity-vjs_video_3_component_374"><option id="captions-window-opacity-vjs_video_3_component_374-Transparent" value="0" aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-opacity-vjs_video_3_component_374 captions-window-opacity-vjs_video_3_component_374-Transparent">Transparent</option><option id="captions-window-opacity-vjs_video_3_component_374-Semi-Transparent" value="0.5" aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-opacity-vjs_video_3_component_374 captions-window-opacity-vjs_video_3_component_374-Semi-Transparent">Semi-Transparent</option><option id="captions-window-opacity-vjs_video_3_component_374-Opaque" value="1" aria-labelledby="captions-window-vjs_video_3_component_374 captions-window-opacity-vjs_video_3_component_374 captions-window-opacity-vjs_video_3_component_374-Opaque">Opaque</option></select></span></fieldset></div><div class="vjs-track-settings-font&quot;>"><fieldset class="vjs-font-percent vjs-track-setting"><legend id="captions-font-size-vjs_video_3_component_374" class="">Font Size</legend><select aria-labelledby=" captions-font-size-vjs_video_3_component_374"><option id="captions-font-size-vjs_video_3_component_374-50%" value="0.50" aria-labelledby=" captions-font-size-vjs_video_3_component_374 captions-font-size-vjs_video_3_component_374-50%">50%</option><option id="captions-font-size-vjs_video_3_component_374-75%" value="0.75" aria-labelledby=" captions-font-size-vjs_video_3_component_374 captions-font-size-vjs_video_3_component_374-75%">75%</option><option id="captions-font-size-vjs_video_3_component_374-100%" value="1.00" aria-labelledby=" captions-font-size-vjs_video_3_component_374 captions-font-size-vjs_video_3_component_374-100%">100%</option><option id="captions-font-size-vjs_video_3_component_374-125%" value="1.25" aria-labelledby=" captions-font-size-vjs_video_3_component_374 captions-font-size-vjs_video_3_component_374-125%">125%</option><option id="captions-font-size-vjs_video_3_component_374-150%" value="1.50" aria-labelledby=" captions-font-size-vjs_video_3_component_374 captions-font-size-vjs_video_3_component_374-150%">150%</option><option id="captions-font-size-vjs_video_3_component_374-175%" value="1.75" aria-labelledby=" captions-font-size-vjs_video_3_component_374 captions-font-size-vjs_video_3_component_374-175%">175%</option><option id="captions-font-size-vjs_video_3_component_374-200%" value="2.00" aria-labelledby=" captions-font-size-vjs_video_3_component_374 captions-font-size-vjs_video_3_component_374-200%">200%</option><option id="captions-font-size-vjs_video_3_component_374-300%" value="3.00" aria-labelledby=" captions-font-size-vjs_video_3_component_374 captions-font-size-vjs_video_3_component_374-300%">300%</option><option id="captions-font-size-vjs_video_3_component_374-400%" value="4.00" aria-labelledby=" captions-font-size-vjs_video_3_component_374 captions-font-size-vjs_video_3_component_374-400%">400%</option></select></fieldset><fieldset class="vjs-edge-style vjs-track-setting"><legend id="vjs_video_3_component_374" class="">Text Edge Style</legend><select aria-labelledby=" vjs_video_3_component_374"><option id="vjs_video_3_component_374-None" value="none" aria-labelledby=" vjs_video_3_component_374 vjs_video_3_component_374-None">None</option><option id="vjs_video_3_component_374-Raised" value="raised" aria-labelledby=" vjs_video_3_component_374 vjs_video_3_component_374-Raised">Raised</option><option id="vjs_video_3_component_374-Depressed" value="depressed" aria-labelledby=" vjs_video_3_component_374 vjs_video_3_component_374-Depressed">Depressed</option><option id="vjs_video_3_component_374-Uniform" value="uniform" aria-labelledby=" vjs_video_3_component_374 vjs_video_3_component_374-Uniform">Uniform</option><option id="vjs_video_3_component_374-Dropshadow" value="dropshadow" aria-labelledby=" vjs_video_3_component_374 vjs_video_3_component_374-Dropshadow">Dropshadow</option></select></fieldset><fieldset class="vjs-font-family vjs-track-setting"><legend id="captions-font-family-vjs_video_3_component_374" class="">Font Family</legend><select aria-labelledby=" captions-font-family-vjs_video_3_component_374"><option id="captions-font-family-vjs_video_3_component_374-Proportional Sans-Serif" value="proportionalSansSerif" aria-labelledby=" captions-font-family-vjs_video_3_component_374 captions-font-family-vjs_video_3_component_374-Proportional Sans-Serif">Proportional Sans-Serif</option><option id="captions-font-family-vjs_video_3_component_374-Monospace Sans-Serif" value="monospaceSansSerif" aria-labelledby=" captions-font-family-vjs_video_3_component_374 captions-font-family-vjs_video_3_component_374-Monospace Sans-Serif">Monospace Sans-Serif</option><option id="captions-font-family-vjs_video_3_component_374-Proportional Serif" value="proportionalSerif" aria-labelledby=" captions-font-family-vjs_video_3_component_374 captions-font-family-vjs_video_3_component_374-Proportional Serif">Proportional Serif</option><option id="captions-font-family-vjs_video_3_component_374-Monospace Serif" value="monospaceSerif" aria-labelledby=" captions-font-family-vjs_video_3_component_374 captions-font-family-vjs_video_3_component_374-Monospace Serif">Monospace Serif</option><option id="captions-font-family-vjs_video_3_component_374-Casual" value="casual" aria-labelledby=" captions-font-family-vjs_video_3_component_374 captions-font-family-vjs_video_3_component_374-Casual">Casual</option><option id="captions-font-family-vjs_video_3_component_374-Script" value="script" aria-labelledby=" captions-font-family-vjs_video_3_component_374 captions-font-family-vjs_video_3_component_374-Script">Script</option><option id="captions-font-family-vjs_video_3_component_374-Small Caps" value="small-caps" aria-labelledby=" captions-font-family-vjs_video_3_component_374 captions-font-family-vjs_video_3_component_374-Small Caps">Small Caps</option></select></fieldset></div><div class="vjs-track-settings-controls"><button class="vjs-default-button" title="restore all settings to the default values">Reset<span class="vjs-control-text"> restore all settings to the default values</span></button><button class="vjs-done-button">Done</button></div></div><button class="vjs-close-button vjs-control vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Close Modal Dialog"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Close Modal Dialog</span></button><p class="vjs-control-text">End of dialog window.</p></div></div></p><h3 id="labdoc-header-4">基本操作</h3>
<p>创建数据库非常简单，只需要输入 <code>create database &lt;db_name&gt;;</code> 就可以了，其中 <code>&lt;db_name&gt;</code> 代表数据库名称，查看所有的数据库可以通过 <code>show databases;</code> (注意，这里多了一个 <code>s</code>) 命令，而删除一个数据库则可以通过 <code>drop database &lt;db_name&gt;;</code> ，下面的例子演示了数据库的创建和删除过程：</p><pre><code class="hljs mysql ruby">mysql&gt; create database shiyanlou;
Query OK, <span class="hljs-number">1</span> row affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)

<span class="hljs-section">mysql&gt; show databases;
+--------------------+</span>
<span class="hljs-section"><span class="hljs-params">| Database           |</span>
+--------------------+</span>
<span class="hljs-params">| information</span><span class="hljs-emphasis"><span class="hljs-params">_schema |</span>
<span class="hljs-params">| mysql              |</span>
<span class="hljs-params">| performance_</span></span><span class="hljs-params">schema |</span>
<span class="hljs-params">| shiyanlou          |</span>
<span class="hljs-section"><span class="hljs-params">| sys                |</span>
+--------------------+</span>
<span class="hljs-number">5</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)

mysql&gt; drop database shiyanlou;
Query OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)

<span class="hljs-section">mysql&gt; show databases;
+--------------------+</span>
<span class="hljs-section"><span class="hljs-params">| Database           |</span>
+--------------------+</span>
<span class="hljs-params">| information</span><span class="hljs-emphasis"><span class="hljs-params">_schema |</span>
<span class="hljs-params">| mysql              |</span>
<span class="hljs-params">| performance_</span></span><span class="hljs-params">schema |</span>
<span class="hljs-section"><span class="hljs-params">| sys                |</span>
+--------------------+</span>
<span class="hljs-number">4</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)
</code></pre><p>需要注意的是 <code>show databases;</code> 的输出结果显示了多个数据库，这是因为 MySQL 服务器有几个默认的数据库，该命令输出结果在不同的 MySQL 版本下可能不一致。</p><p>数据库创建成功以后，就可以创建表了。在创建表之前，需要通过 <code>use shiyanlou;</code> 命令连接到 <code>shiyanlou</code> 数据库。</p><p>创建表的基本命令如下：</p><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> 表的名字
<span class="hljs-comment">(
列名a 数据类型(数据长度)</span>,
列名b 数据类型<span class="hljs-comment">(数据长度)</span>，
列名c 数据类型<span class="hljs-comment">(数据长度)</span>
);
</code></pre><p>下面尝试创建一张表名为 <code>user</code> 的表，该表有 3 个字段：</p><ul>
<li>id 编号，整数类型，使用 <code>int</code> 类型；</li>
<li>name 用户名，字符串，使用 <code>varchar</code> 可变字符类型；</li>
<li>email 邮箱，字符串, 使用 <code>varchar</code> 可变字符型；</li>
</ul>
<p>在 MySQL 客户端输入下面的命令：</p><pre><code class="hljs mysql coffeescript">mysql&gt; create database shiyanlou;
mysql&gt; use shiyanlou;
Database changed
mysql&gt; create table user
<span class="hljs-code">    -&gt; (</span>
<span class="hljs-code">    <span class="hljs-function">-&gt;</span> id int(<span class="hljs-number">10</span>),</span>
<span class="hljs-code">    <span class="hljs-function">-&gt;</span> name varchar(<span class="hljs-number">20</span>),</span>
<span class="hljs-code">    <span class="hljs-function">-&gt;</span> email varchar(<span class="hljs-number">64</span>)</span>
<span class="hljs-code">    -&gt; );</span>
Query OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0.03</span> sec)
<span class="hljs-section">mysql&gt; show tables;
+---------------------+</span>
<span class="hljs-section">| Tables_in_shiyanlou |
+---------------------+</span>
<span class="hljs-section">| user                |
+---------------------+</span>
<span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)
</code></pre><p>通过以上命令就可以创建出 <code>user</code> 表，需要注意的是当输入 <code>create table user</code> 回车以后，客户端会自动识别出这是一个未完成的命令，所以会出现提示符 <code>-&gt;</code> 。表创建成功以后，可以通过 <code>show tables;</code> 查看所有的表, 删除表可以通过 <code>drop table &lt;table_name&gt;;</code> 。</p><p>如果想查看一张表的字段信息，可以通过 <code>show create table &lt;table_name&gt;;</code> 或者 <code>describe &lt;table_name&gt;;</code> 指令，如下所示：</p><pre><code class="hljs mysql ruby">mysql&gt; show create table<span class="hljs-built_in"> user;
</span>
<span class="hljs-params">|</span><span class="hljs-built_in"><span class="hljs-params"> user </span></span><span class="hljs-params"> |</span> CREATE TABLE <span class="hljs-string">`user`</span> (
  <span class="hljs-string">`id`</span> int(<span class="hljs-number">10</span>)<span class="hljs-built_in"> DEFAULT </span><span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`name`</span> varchar(<span class="hljs-number">20</span>)<span class="hljs-built_in"> DEFAULT </span><span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`email`</span> varchar(<span class="hljs-number">64</span>)<span class="hljs-built_in"> DEFAULT </span><span class="hljs-literal">NULL</span>
) <span class="hljs-attribute">ENGINE</span>=InnoDB<span class="hljs-built_in"> DEFAULT </span><span class="hljs-attribute">CHARSET</span>=utf8 <span class="hljs-params">|
1 row </span><span class="hljs-keyword"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span><span class="hljs-params"> </span><span class="hljs-builtin-name"><span class="hljs-params">set</span></span><span class="hljs-params"> (0.00 sec)

mysql&gt; describe</span><span class="hljs-built_in"><span class="hljs-params"> user;
</span></span><span class="hljs-params">+-------+-------------+------+-----+---------+-------+
|</span> Field <span class="hljs-params">|</span><span class="hljs-built_in"><span class="hljs-params"> Type </span></span><span class="hljs-params">       |</span> <span class="hljs-literal">Null</span> <span class="hljs-params">| Key |</span><span class="hljs-built_in"> Default </span><span class="hljs-params">| Extra |</span>
+-------+-------------+------+-----+---------+-------+
<span class="hljs-params">| id    |</span> int(<span class="hljs-number">10</span>)     <span class="hljs-params">| </span><span class="hljs-literal"><span class="hljs-params">YES</span></span><span class="hljs-params">  |</span>     <span class="hljs-params">| </span><span class="hljs-literal"><span class="hljs-params">NULL</span></span><span class="hljs-params">    |</span>       <span class="hljs-params">|
|</span> name  <span class="hljs-params">| varchar(20) |</span> <span class="hljs-literal">YES</span>  <span class="hljs-params">|     |</span> <span class="hljs-literal">NULL</span>    <span class="hljs-params">|       |</span>
<span class="hljs-params">| email |</span> varchar(<span class="hljs-number">64</span>) <span class="hljs-params">| </span><span class="hljs-literal"><span class="hljs-params">YES</span></span><span class="hljs-params">  |</span>     <span class="hljs-params">| </span><span class="hljs-literal"><span class="hljs-params">NULL</span></span><span class="hljs-params">    |</span>       <span class="hljs-params">|
+-------+-------------+------+-----+---------+-------+
3 rows </span><span class="hljs-keyword"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span><span class="hljs-params"> </span><span class="hljs-builtin-name"><span class="hljs-params">set</span></span><span class="hljs-params"> (0.00 sec)
</span></code></pre><p>MySQL 表的字段支持多种类型，如整数，浮点数，字符串，时间戳等，篇幅有限就不一一介绍了。</p><p>表创建成功以后，就可以插入数据了。可以使用 <code>insert</code> 指令插入数据，完整的命令格式如下：</p><pre><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> 表的名字(列名a,列名b,列名c) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(值<span class="hljs-number"><span class="hljs-number">1</span></span>,值<span class="hljs-number"><span class="hljs-number">2</span></span>,值<span class="hljs-number"><span class="hljs-number">3</span></span>);
</code></pre><p>当插入的值和表定义的字段数量一致且顺序一致时，可以忽略列名信息，通过以下命令往 <code>user</code> 表中插入数据：</p><pre><code class="hljs mysql cs">mysql&gt; <span class="hljs-keyword"><span class="hljs-function">insert</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">into</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-title">user</span></span></span><span class="hljs-function">(<span class="hljs-params">id, name, email</span>) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-title">values</span></span></span><span class="hljs-function">(</span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'aiden'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'luojin@simplecloud.cn'</span></span></span></span><span class="hljs-function">)</span>;
Query OK, <span class="hljs-number">1</span> <span class="hljs-function">row <span class="hljs-title">affected</span> (<span class="hljs-params"><span class="hljs-number">0.02</span> sec</span>)

mysql&gt; </span><span class="hljs-keyword"><span class="hljs-function">insert</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">into</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function">user</span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-title">values</span></span></span><span class="hljs-function">(</span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'lxttx'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'lxttx@gmail.com'</span></span></span></span><span class="hljs-function">)</span>;
Query OK, <span class="hljs-number">1</span> <span class="hljs-function">row <span class="hljs-title">affected</span> (<span class="hljs-params"><span class="hljs-number">0.00</span> sec</span>)
</span></code></pre><p>成功的插入两条数据。查看某张表的数据可以通过 <code>select * from &lt;table_name&gt;;</code> 查看：</p><pre><code class="hljs mysql ruby"><span class="hljs-section">mysql&gt; select * from user;
+------+-------+-----------------------+</span>
<span class="hljs-section"><span class="hljs-params">| id   |</span> name  <span class="hljs-params">| email                 |</span>
+------+-------+-----------------------+</span>
<span class="hljs-params">|    1 |</span> aiden <span class="hljs-params">| luojin@simplecloud.cn |</span>
<span class="hljs-section"><span class="hljs-params">|    2 |</span> lxttx <span class="hljs-params">| lxttx@gmail.com       |</span>
+------+-------+-----------------------+</span>
<span class="hljs-number">2</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)
</code></pre><p>到这里我们已经学会了创建数据库和表，插入记录，查询记录等基本操作，是不是非常简单？</p><p>MySQL 基本操作视频：</p><p><div tabindex="-1" id="vjs_video_410" data-setup="{&quot;fluid&quot;:true}" preload="auto" class="video-js vjs-default-skin vjs-paused vjs-fluid vjs_video_410-dimensions vjs-controls-enabled vjs-workinghover vjs-v6 vjs-user-inactive" lang="zh-cn" role="region" aria-label="Video Player"><video class="vjs-tech" preload="auto" data-setup="{&quot;fluid&quot;:true}" id="vjs_video_410_html5_api" tabindex="-1"><source src="https://labfile.oss.aliyuncs.com/courses/923/week2_mp4/2-2-2-mac.mp4" type="video/mp4"></video><div class="vjs-poster vjs-hidden" tabindex="-1" aria-disabled="false"></div><div class="vjs-text-track-display" aria-live="off" aria-atomic="true"></div><div class="vjs-loading-spinner" dir="ltr"></div><button class="vjs-big-play-button" type="button" aria-live="polite" title="Play Video" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Play Video</span></button><div class="vjs-control-bar" dir="ltr" role="group"><button class="vjs-play-control vjs-control vjs-button" type="button" aria-live="polite" title="Play" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Play</span></button><div class="vjs-volume-panel vjs-control vjs-volume-panel-horizontal"><button class="vjs-mute-control vjs-control vjs-button vjs-vol-3" type="button" aria-live="polite" title="Mute" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Mute</span></button><div class="vjs-volume-control vjs-control vjs-volume-horizontal"><div tabindex="0" class="vjs-volume-bar vjs-slider-bar vjs-slider vjs-slider-horizontal" role="slider" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" aria-label="Volume Level" aria-live="polite" aria-valuetext="100%"><div class="vjs-volume-level"><span class="vjs-control-text"></span></div></div></div></div><div class="vjs-current-time vjs-time-control vjs-control"><div class="vjs-current-time-display" aria-live="off"><span class="vjs-control-text">Current Time</span> 0:00</div></div><div class="vjs-time-control vjs-time-divider"><div><span>/</span></div></div><div class="vjs-duration vjs-time-control vjs-control"><div class="vjs-duration-display" aria-live="off"><span class="vjs-control-text">Duration Time</span> 5:26</div></div><div class="vjs-progress-control vjs-control"><div tabindex="0" class="vjs-progress-holder vjs-slider vjs-slider-horizontal" role="slider" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Progress Bar"><div class="vjs-load-progress" style="width: 0%;"><span class="vjs-control-text"><span>Loaded</span>: 0%</span><div style="left: 0%; width: 0%;"></div></div><div class="vjs-mouse-display"><div class="vjs-time-tooltip"></div></div><div class="vjs-play-progress vjs-slider-bar"><div class="vjs-time-tooltip"></div><span class="vjs-control-text"><span>Progress</span>: 0%</span></div></div></div><div class="vjs-live-control vjs-control vjs-hidden"><div class="vjs-live-display" aria-live="off"><span class="vjs-control-text">Stream Type</span>LIVE</div></div><div class="vjs-remaining-time vjs-time-control vjs-control"><div class="vjs-remaining-time-display" aria-live="off"><span class="vjs-control-text">Remaining Time</span> -5:26</div></div><div class="vjs-custom-control-spacer vjs-spacer ">&nbsp;</div><div class="vjs-playback-rate vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-playback-rate vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Playback Rate" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Playback Rate</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"></ul></div><div class="vjs-playback-rate-value">1x</div></div><div class="vjs-chapters-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-chapters-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Chapters" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Chapters</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-title" tabindex="-1">Chapters</li></ul></div></div><div class="vjs-descriptions-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-descriptions-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Descriptions" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Descriptions</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-item vjs-selected" tabindex="-1" role="menuitemcheckbox" aria-live="polite" aria-disabled="false" aria-checked="true"><span class="vjs-menu-item-text">descriptions off</span><span class="vjs-control-text">, selected</span></li></ul></div></div><div class="vjs-subs-caps-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-subs-caps-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Subtitles" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Subtitles</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-item vjs-texttrack-settings" tabindex="-1" role="menuitem" aria-live="polite" aria-disabled="false"><span class="vjs-menu-item-text">subtitles settings</span><span class="vjs-control-text">, opens subtitles settings dialog</span></li><li class="vjs-menu-item vjs-selected" tabindex="-1" role="menuitemcheckbox" aria-live="polite" aria-disabled="false" aria-checked="true"><span class="vjs-menu-item-text">subtitles off</span><span class="vjs-control-text">, selected</span></li></ul></div></div><div class="vjs-audio-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-audio-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Audio Track" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Audio Track</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"></ul></div></div><button class="vjs-fullscreen-control vjs-control vjs-button" type="button" aria-live="polite" title="Fullscreen" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Fullscreen</span></button></div><div class="vjs-error-display vjs-modal-dialog vjs-hidden " tabindex="-1" aria-describedby="vjs_video_410_component_717_description" aria-hidden="true" aria-label="Modal Window" role="dialog"><p class="vjs-modal-dialog-description vjs-control-text" id="vjs_video_410_component_717_description">This is a modal window.</p><div class="vjs-modal-dialog-content" role="document"></div></div><div class="vjs-modal-dialog vjs-hidden  vjs-text-track-settings" tabindex="-1" aria-describedby="vjs_video_410_component_722_description" aria-hidden="true" aria-label="Caption Settings Dialog" role="dialog"><p class="vjs-modal-dialog-description vjs-control-text" id="vjs_video_410_component_722_description">Beginning of dialog window. Escape will cancel and close the window.</p><div class="vjs-modal-dialog-content" role="document"><div class="vjs-track-settings-colors"><fieldset class="vjs-fg-color vjs-track-setting"><legend id="captions-text-legend-vjs_video_410_component_722">Text</legend><label id="captions-foreground-color-vjs_video_410_component_722" class="vjs-label">Color</label><select aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722"><option id="captions-foreground-color-vjs_video_410_component_722-White" value="#FFF" aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722-White">White</option><option id="captions-foreground-color-vjs_video_410_component_722-Black" value="#000" aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722-Black">Black</option><option id="captions-foreground-color-vjs_video_410_component_722-Red" value="#F00" aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722-Red">Red</option><option id="captions-foreground-color-vjs_video_410_component_722-Green" value="#0F0" aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722-Green">Green</option><option id="captions-foreground-color-vjs_video_410_component_722-Blue" value="#00F" aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722-Blue">Blue</option><option id="captions-foreground-color-vjs_video_410_component_722-Yellow" value="#FF0" aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722-Yellow">Yellow</option><option id="captions-foreground-color-vjs_video_410_component_722-Magenta" value="#F0F" aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722-Magenta">Magenta</option><option id="captions-foreground-color-vjs_video_410_component_722-Cyan" value="#0FF" aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722 captions-foreground-color-vjs_video_410_component_722-Cyan">Cyan</option></select><span class="vjs-text-opacity vjs-opacity"><label id="captions-foreground-opacity-vjs_video_410_component_722" class="vjs-label">Transparency</label><select aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-opacity-vjs_video_410_component_722"><option id="captions-foreground-opacity-vjs_video_410_component_722-Opaque" value="1" aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-opacity-vjs_video_410_component_722 captions-foreground-opacity-vjs_video_410_component_722-Opaque">Opaque</option><option id="captions-foreground-opacity-vjs_video_410_component_722-Semi-Transparent" value="0.5" aria-labelledby="captions-text-legend-vjs_video_410_component_722 captions-foreground-opacity-vjs_video_410_component_722 captions-foreground-opacity-vjs_video_410_component_722-Semi-Transparent">Semi-Transparent</option></select></span></fieldset><fieldset class="vjs-bg-color vjs-track-setting"><legend id="captions-background-vjs_video_410_component_722">Background</legend><label id="captions-background-color-vjs_video_410_component_722" class="vjs-label">Color</label><select aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722"><option id="captions-background-color-vjs_video_410_component_722-Black" value="#000" aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722-Black">Black</option><option id="captions-background-color-vjs_video_410_component_722-White" value="#FFF" aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722-White">White</option><option id="captions-background-color-vjs_video_410_component_722-Red" value="#F00" aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722-Red">Red</option><option id="captions-background-color-vjs_video_410_component_722-Green" value="#0F0" aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722-Green">Green</option><option id="captions-background-color-vjs_video_410_component_722-Blue" value="#00F" aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722-Blue">Blue</option><option id="captions-background-color-vjs_video_410_component_722-Yellow" value="#FF0" aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722-Yellow">Yellow</option><option id="captions-background-color-vjs_video_410_component_722-Magenta" value="#F0F" aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722-Magenta">Magenta</option><option id="captions-background-color-vjs_video_410_component_722-Cyan" value="#0FF" aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722 captions-background-color-vjs_video_410_component_722-Cyan">Cyan</option></select><span class="vjs-bg-opacity vjs-opacity"><label id="captions-background-opacity-vjs_video_410_component_722" class="vjs-label">Transparency</label><select aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-opacity-vjs_video_410_component_722"><option id="captions-background-opacity-vjs_video_410_component_722-Opaque" value="1" aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-opacity-vjs_video_410_component_722 captions-background-opacity-vjs_video_410_component_722-Opaque">Opaque</option><option id="captions-background-opacity-vjs_video_410_component_722-Semi-Transparent" value="0.5" aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-opacity-vjs_video_410_component_722 captions-background-opacity-vjs_video_410_component_722-Semi-Transparent">Semi-Transparent</option><option id="captions-background-opacity-vjs_video_410_component_722-Transparent" value="0" aria-labelledby="captions-background-vjs_video_410_component_722 captions-background-opacity-vjs_video_410_component_722 captions-background-opacity-vjs_video_410_component_722-Transparent">Transparent</option></select></span></fieldset><fieldset class="vjs-window-color vjs-track-setting"><legend id="captions-window-vjs_video_410_component_722">Window</legend><label id="captions-window-color-vjs_video_410_component_722" class="vjs-label">Color</label><select aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722"><option id="captions-window-color-vjs_video_410_component_722-Black" value="#000" aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722-Black">Black</option><option id="captions-window-color-vjs_video_410_component_722-White" value="#FFF" aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722-White">White</option><option id="captions-window-color-vjs_video_410_component_722-Red" value="#F00" aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722-Red">Red</option><option id="captions-window-color-vjs_video_410_component_722-Green" value="#0F0" aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722-Green">Green</option><option id="captions-window-color-vjs_video_410_component_722-Blue" value="#00F" aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722-Blue">Blue</option><option id="captions-window-color-vjs_video_410_component_722-Yellow" value="#FF0" aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722-Yellow">Yellow</option><option id="captions-window-color-vjs_video_410_component_722-Magenta" value="#F0F" aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722-Magenta">Magenta</option><option id="captions-window-color-vjs_video_410_component_722-Cyan" value="#0FF" aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722 captions-window-color-vjs_video_410_component_722-Cyan">Cyan</option></select><span class="vjs-window-opacity vjs-opacity"><label id="captions-window-opacity-vjs_video_410_component_722" class="vjs-label">Transparency</label><select aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-opacity-vjs_video_410_component_722"><option id="captions-window-opacity-vjs_video_410_component_722-Transparent" value="0" aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-opacity-vjs_video_410_component_722 captions-window-opacity-vjs_video_410_component_722-Transparent">Transparent</option><option id="captions-window-opacity-vjs_video_410_component_722-Semi-Transparent" value="0.5" aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-opacity-vjs_video_410_component_722 captions-window-opacity-vjs_video_410_component_722-Semi-Transparent">Semi-Transparent</option><option id="captions-window-opacity-vjs_video_410_component_722-Opaque" value="1" aria-labelledby="captions-window-vjs_video_410_component_722 captions-window-opacity-vjs_video_410_component_722 captions-window-opacity-vjs_video_410_component_722-Opaque">Opaque</option></select></span></fieldset></div><div class="vjs-track-settings-font&quot;>"><fieldset class="vjs-font-percent vjs-track-setting"><legend id="captions-font-size-vjs_video_410_component_722" class="">Font Size</legend><select aria-labelledby=" captions-font-size-vjs_video_410_component_722"><option id="captions-font-size-vjs_video_410_component_722-50%" value="0.50" aria-labelledby=" captions-font-size-vjs_video_410_component_722 captions-font-size-vjs_video_410_component_722-50%">50%</option><option id="captions-font-size-vjs_video_410_component_722-75%" value="0.75" aria-labelledby=" captions-font-size-vjs_video_410_component_722 captions-font-size-vjs_video_410_component_722-75%">75%</option><option id="captions-font-size-vjs_video_410_component_722-100%" value="1.00" aria-labelledby=" captions-font-size-vjs_video_410_component_722 captions-font-size-vjs_video_410_component_722-100%">100%</option><option id="captions-font-size-vjs_video_410_component_722-125%" value="1.25" aria-labelledby=" captions-font-size-vjs_video_410_component_722 captions-font-size-vjs_video_410_component_722-125%">125%</option><option id="captions-font-size-vjs_video_410_component_722-150%" value="1.50" aria-labelledby=" captions-font-size-vjs_video_410_component_722 captions-font-size-vjs_video_410_component_722-150%">150%</option><option id="captions-font-size-vjs_video_410_component_722-175%" value="1.75" aria-labelledby=" captions-font-size-vjs_video_410_component_722 captions-font-size-vjs_video_410_component_722-175%">175%</option><option id="captions-font-size-vjs_video_410_component_722-200%" value="2.00" aria-labelledby=" captions-font-size-vjs_video_410_component_722 captions-font-size-vjs_video_410_component_722-200%">200%</option><option id="captions-font-size-vjs_video_410_component_722-300%" value="3.00" aria-labelledby=" captions-font-size-vjs_video_410_component_722 captions-font-size-vjs_video_410_component_722-300%">300%</option><option id="captions-font-size-vjs_video_410_component_722-400%" value="4.00" aria-labelledby=" captions-font-size-vjs_video_410_component_722 captions-font-size-vjs_video_410_component_722-400%">400%</option></select></fieldset><fieldset class="vjs-edge-style vjs-track-setting"><legend id="vjs_video_410_component_722" class="">Text Edge Style</legend><select aria-labelledby=" vjs_video_410_component_722"><option id="vjs_video_410_component_722-None" value="none" aria-labelledby=" vjs_video_410_component_722 vjs_video_410_component_722-None">None</option><option id="vjs_video_410_component_722-Raised" value="raised" aria-labelledby=" vjs_video_410_component_722 vjs_video_410_component_722-Raised">Raised</option><option id="vjs_video_410_component_722-Depressed" value="depressed" aria-labelledby=" vjs_video_410_component_722 vjs_video_410_component_722-Depressed">Depressed</option><option id="vjs_video_410_component_722-Uniform" value="uniform" aria-labelledby=" vjs_video_410_component_722 vjs_video_410_component_722-Uniform">Uniform</option><option id="vjs_video_410_component_722-Dropshadow" value="dropshadow" aria-labelledby=" vjs_video_410_component_722 vjs_video_410_component_722-Dropshadow">Dropshadow</option></select></fieldset><fieldset class="vjs-font-family vjs-track-setting"><legend id="captions-font-family-vjs_video_410_component_722" class="">Font Family</legend><select aria-labelledby=" captions-font-family-vjs_video_410_component_722"><option id="captions-font-family-vjs_video_410_component_722-Proportional Sans-Serif" value="proportionalSansSerif" aria-labelledby=" captions-font-family-vjs_video_410_component_722 captions-font-family-vjs_video_410_component_722-Proportional Sans-Serif">Proportional Sans-Serif</option><option id="captions-font-family-vjs_video_410_component_722-Monospace Sans-Serif" value="monospaceSansSerif" aria-labelledby=" captions-font-family-vjs_video_410_component_722 captions-font-family-vjs_video_410_component_722-Monospace Sans-Serif">Monospace Sans-Serif</option><option id="captions-font-family-vjs_video_410_component_722-Proportional Serif" value="proportionalSerif" aria-labelledby=" captions-font-family-vjs_video_410_component_722 captions-font-family-vjs_video_410_component_722-Proportional Serif">Proportional Serif</option><option id="captions-font-family-vjs_video_410_component_722-Monospace Serif" value="monospaceSerif" aria-labelledby=" captions-font-family-vjs_video_410_component_722 captions-font-family-vjs_video_410_component_722-Monospace Serif">Monospace Serif</option><option id="captions-font-family-vjs_video_410_component_722-Casual" value="casual" aria-labelledby=" captions-font-family-vjs_video_410_component_722 captions-font-family-vjs_video_410_component_722-Casual">Casual</option><option id="captions-font-family-vjs_video_410_component_722-Script" value="script" aria-labelledby=" captions-font-family-vjs_video_410_component_722 captions-font-family-vjs_video_410_component_722-Script">Script</option><option id="captions-font-family-vjs_video_410_component_722-Small Caps" value="small-caps" aria-labelledby=" captions-font-family-vjs_video_410_component_722 captions-font-family-vjs_video_410_component_722-Small Caps">Small Caps</option></select></fieldset></div><div class="vjs-track-settings-controls"><button class="vjs-default-button" title="restore all settings to the default values">Reset<span class="vjs-control-text"> restore all settings to the default values</span></button><button class="vjs-done-button">Done</button></div></div><button class="vjs-close-button vjs-control vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Close Modal Dialog"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Close Modal Dialog</span></button><p class="vjs-control-text">End of dialog window.</p></div></div></p><h3 id="labdoc-header-5">约束</h3>
<p>MySQL 是一个关系数据库，可以通过约束限制一些数据操作。比如插入数据时，可以检查该数据是否满足关系约束，如果不满足则拒绝操作。下面通过一个简单的例子进行演示。</p><p>在前一小节中，我们创建了 <code>user</code> 表，且插入了下面的两条数据：</p><pre><code class="hljs mysql ruby"><span class="hljs-section">mysql&gt; select * from user;
+------+-------+-----------------------+</span>
<span class="hljs-section"><span class="hljs-params">| id   |</span> name  <span class="hljs-params">| email                 |</span>
+------+-------+-----------------------+</span>
<span class="hljs-params">|    1 |</span> aiden <span class="hljs-params">| luojin@simplecloud.cn |</span>
<span class="hljs-section"><span class="hljs-params">|    2 |</span> lxttx <span class="hljs-params">| lxttx@gmail.com       |</span>
+------+-------+-----------------------+</span>
</code></pre><p>现在重新再插入一条数据：</p><pre><code class="hljs mysql ruby">mysql&gt; insert into user values(<span class="hljs-number">3</span>, <span class="hljs-emphasis"><span class="hljs-string">'lxttx_1'</span></span>, <span class="hljs-emphasis"><span class="hljs-string">'lxttx@gmail.com'</span></span>);
Query OK, <span class="hljs-number">1</span> row affected (<span class="hljs-number">0</span>.<span class="hljs-number">01</span> sec)

<span class="hljs-section">mysql&gt; select * from user;
+------+---------+-----------------------+</span>
<span class="hljs-section"><span class="hljs-params">| id   |</span> name    <span class="hljs-params">| email                 |</span>
+------+---------+-----------------------+</span>
<span class="hljs-params">|    1 |</span> aiden   <span class="hljs-params">| luojin@simplecloud.cn |</span>
<span class="hljs-params">|    2 |</span> lxttx   <span class="hljs-params">| lxttx@gmail.com       |</span>
<span class="hljs-section"><span class="hljs-params">|    3 |</span> lxttx_1 <span class="hljs-params">| lxttx@gmail.com       |</span>
+------+---------+-----------------------+</span>
<span class="hljs-number">3</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)
</code></pre><p>数据成功插入，但是现在有点问题，对于一个正式上线的数据库来说，一般不允许在一张用户表存在邮箱相同的用户，也就是说要求 <code>email</code> 字段具有唯一约束。这个时候怎么办呢？对于一个已经存在的表，可以通过 <code>alter</code> 指令修改表的字段，设置唯一约束：</p><pre><code class="hljs mysql cs">mysql&gt; <span class="hljs-function">alter table user modify email <span class="hljs-title">varchar</span>(<span class="hljs-params"><span class="hljs-number">64</span></span>) unique</span>;
<span class="hljs-keyword">ERROR </span><span class="hljs-number">1062</span> (<span class="hljs-number">23000</span>): Duplicate entry <span class="hljs-string">'lxttx@gmail.com'</span> <span class="hljs-keyword">for</span> key <span class="hljs-string">'email'</span>
mysql&gt; delete <span class="hljs-keyword">from</span> user <span class="hljs-keyword">where</span> id = <span class="hljs-number">3</span>;
Query OK, <span class="hljs-number">1</span> <span class="hljs-function">row <span class="hljs-title">affected</span> (<span class="hljs-params"><span class="hljs-number">0.00</span> sec</span>)

mysql&gt; alter table user <span class="hljs-keyword">add</span> constraint <span class="hljs-title">unique</span> (<span class="hljs-params">email</span>)</span>;
Query OK, <span class="hljs-number">0</span> <span class="hljs-function">rows <span class="hljs-title">affected</span> (<span class="hljs-params"><span class="hljs-number">0.03</span> sec</span>)
Records: 0  Duplicates: 0  Warnings: 0

mysql&gt; insert <span class="hljs-keyword">into</span> user <span class="hljs-title">values</span>(<span class="hljs-params"><span class="hljs-number">3</span>, <span class="hljs-string">'lxttx_1'</span>, <span class="hljs-string">'lxttx@gmail.com'</span></span>)</span>;
<span class="hljs-keyword">ERROR </span><span class="hljs-number">1062</span> (<span class="hljs-number">23000</span>): Duplicate entry <span class="hljs-string">'lxttx@gmail.com'</span> <span class="hljs-keyword">for</span> key <span class="hljs-string">'email'</span>
</code></pre><p>以上命令中，先尝试修改 <code>email</code> 字段设置唯一约束，但是数据库报错，因为<code>user</code> 表中已存在重复的邮箱记录。接着使用 <code>delete from user where id = 3;</code> 删除了重复记录，该命令的含义是删除 id 为 3 的记录。接着成功设置了 <code>email</code> 的唯一索引，然后插入重复记录时已被禁止。添加唯一约束还有一种方式为 <code>alter table user modify email varchar(64) unique;</code>，这种方式实际上是通过修改字段添加唯一索引。</p><p>还有一种约束，是跨表的。在表中插入数据项时，要求该数据项的某一个字段值必须已经在其他表中存在，比如外键约束。插入数据时，如果不满足外键约束则不允许插入，删除数据如果破坏了外键约束也会禁止删除数据。外键约束创建时，必须要求另一张表中存在主键，主键在表中能唯一的确定某一行的值。下面尝试创建一张具有外键约束的 <code>course</code> 表，在创建 <code>course</code> 表之前，需要在 <code>user</code> 表中设置主键：</p><pre><code class="hljs mysql ruby">mysql&gt; alter table<span class="hljs-built_in"> user </span><span class="hljs-builtin-name">add</span> constraint pk_id primary key (id);                                                       Query OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">14</span> sec)
<span class="hljs-symbol">Records:</span> <span class="hljs-number">0</span>  <span class="hljs-symbol">Duplicates:</span> <span class="hljs-number">0</span>  <span class="hljs-symbol">Warnings:</span> <span class="hljs-number">0</span>

mysql&gt; describe<span class="hljs-built_in"> user;
</span>+-------+-------------+------+-----+---------+-------+
<span class="hljs-params">| Field |</span><span class="hljs-built_in"> Type </span>       <span class="hljs-params">| </span><span class="hljs-literal"><span class="hljs-params">Null</span></span><span class="hljs-params"> |</span> Key <span class="hljs-params">|</span><span class="hljs-built_in"><span class="hljs-params"> Default </span></span><span class="hljs-params">|</span> Extra <span class="hljs-params">|
+-------+-------------+------+-----+---------+-------+
|</span> id    <span class="hljs-params">| int(10)     |</span> <span class="hljs-literal">NO</span>   <span class="hljs-params">| PRI |</span> <span class="hljs-literal">NULL</span>    <span class="hljs-params">|       |</span>
<span class="hljs-params">| name  |</span> varchar(<span class="hljs-number">20</span>) <span class="hljs-params">| </span><span class="hljs-literal"><span class="hljs-params">YES</span></span><span class="hljs-params">  |</span> UNI <span class="hljs-params">| </span><span class="hljs-literal"><span class="hljs-params">NULL</span></span><span class="hljs-params">    |</span>       <span class="hljs-params">|
|</span> email <span class="hljs-params">| varchar(64) |</span> <span class="hljs-literal">YES</span>  <span class="hljs-params">| UNI |</span> <span class="hljs-literal">NULL</span>    <span class="hljs-params">|       |</span>
+-------+-------------+------+-----+---------+-------+
<span class="hljs-number">3</span> rows <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-builtin-name">set</span> (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)
</code></pre><p>通过 <code>alter</code> 指令成功在 <code>user</code> 中设置 <code>id</code> 字段为主键。通过 <code>describe user;</code> 命令输出确实发现 <code>id</code> 列变成了主键（因为 Key 列的值为 <code>PRI</code>, 代表 <code>primary</code>）。接着创建 <code>course</code> 表：</p><pre><code class="hljs mysql coffeescript">mysql&gt; create table course 
    -<span class="ruby">&gt; (
</span>    <span class="hljs-function">-</span><span class="ruby"><span class="hljs-function">&gt;</span> id int(<span class="hljs-number"><span class="hljs-number">10</span></span>) auto_increment,
</span>    <span class="hljs-function">-</span><span class="ruby"><span class="hljs-function">&gt;</span> name varchar(<span class="hljs-number"><span class="hljs-number">64</span></span>),
</span>    <span class="hljs-function">-</span><span class="ruby"><span class="hljs-function">&gt;</span> teacher_id int(<span class="hljs-number"><span class="hljs-number">10</span></span>),
</span>    <span class="hljs-function">-</span><span class="ruby"><span class="hljs-function">&gt;</span> primary key (id),
</span>    <span class="hljs-function">-</span><span class="ruby"><span class="hljs-function">&gt;</span> constraint fk_user foreign key (teacher_id) references user(id)
</span>    -<span class="ruby">&gt; );
</span>Query OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0.04</span> sec)
</code></pre><p>以上命令相对于之前建表命令增加了一些内容，首先通过 <code>auto_increment</code> 指定了字段 <code>id</code> 为自增模式，这样每次插入数据时不用指定该字段，插入数据后这个字段会自动增加。接着通过 <code>primary key (id)</code> 语句指定了这个表的主键为 <code>id</code>, 最后设置了字段 <code>teacher_id</code> 为外键，且关联到了 <code>user</code> 表的 <code>id</code> 字段。现在尝试往 <code>course</code> 表中插入一条 <code>teacher_id</code> 在 <code>user</code> 表中不存在的数据：</p><pre><code class="hljs perl">mysql&gt; <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> course(name, teacher_id) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>(<span class="hljs-string"><span class="hljs-string">'Python基础'</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>);
ERROR <span class="hljs-number">1452</span> (<span class="hljs-number">23000</span>): Cannot add <span class="hljs-keyword">or</span> <span class="hljs-keyword">update</span> a child row: a foreign <span class="hljs-keyword">key</span> constraint fails (<span class="hljs-symbol"><span class="hljs-string">`shiyanlou`</span></span>.<span class="hljs-symbol"><span class="hljs-string">`course`</span></span>, CONSTRAINT <span class="hljs-symbol"><span class="hljs-string">`fk_user`</span></span> FOREIGN <span class="hljs-keyword">KEY</span> (<span class="hljs-symbol"><span class="hljs-string">`teacher_id`</span></span>) REFERENCES <span class="hljs-symbol"><span class="hljs-string">`user`</span></span> (<span class="hljs-symbol"><span class="hljs-string">`id`</span></span>))
</code></pre><p>环境中输入中文并不方便，需要点击右下角的小键盘才可以切换输入法，如果觉得太麻烦可以直接输入英文即可，实验操作都是一致的，并不要求每个内容都完全相同，但需要理解每一个步骤和操作参数的作用。</p><p>可以看到，数据插入失败。因为 <code>user</code> 表中不存在 <code>id</code> 为 100 的数据，不满足外键约束。删除数据时，如果违反了外键约束也将删除失败：</p><pre><code class="hljs ruby"><span class="hljs-section">mysql&gt; select * from user;
+----+-------+-----------------------+</span>
<span class="hljs-section"><span class="hljs-params">| id |</span> name  <span class="hljs-params">| email                 |</span>
+----+-------+-----------------------+</span>
<span class="hljs-params">|  1 |</span> aiden <span class="hljs-params">| luojin@simplecloud.cn |</span>
<span class="hljs-section"><span class="hljs-params">|  2 |</span> lxttx <span class="hljs-params">| lxttx@gmail.com       |</span>
+----+-------+-----------------------+</span>
<span class="hljs-number">2</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)

mysql&gt; insert into course(name, teacher<span class="hljs-emphasis">_id) values(<span class="hljs-string">'Python 基础'</span>, <span class="hljs-number">2</span>);
Query OK, <span class="hljs-number">1</span> row affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)

</span><span class="hljs-section">mysql&gt; select * from course;
+----+---------------+------------+</span>
<span class="hljs-section"><span class="hljs-params">| id |</span> name          <span class="hljs-params">| teacher_id |</span>
+----+---------------+------------+</span>
<span class="hljs-section"><span class="hljs-params">|  2 |</span> Python 基础   <span class="hljs-params">|          2 |</span>
+----+---------------+------------+</span>
<span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)

mysql&gt; delete from user where id = <span class="hljs-number">2</span>;
ERROR <span class="hljs-number">1451</span> (<span class="hljs-number">23000</span>): Cannot delete <span class="hljs-keyword">or</span> update a parent <span class="hljs-symbol">row:</span> a foreign key constraint fails (<span class="hljs-code"><span class="hljs-string">`shiyanlou`</span></span>.<span class="hljs-code"><span class="hljs-string">`course`</span></span>, CONSTRAINT <span class="hljs-code"><span class="hljs-string">`fk_user`</span></span> FOREIGN KEY (<span class="hljs-code"><span class="hljs-string">`teacher_id`</span></span>) REFERENCES <span class="hljs-code"><span class="hljs-string">`user`</span></span> (<span class="hljs-code"><span class="hljs-string">`id`</span></span>))
</code></pre><p>上面的例子中，为了演示删除失败的情况，先往 <code>course</code> 表中插入了一条数据，接着尝试从 <code>user</code> 表中删除 <code>id</code> 为 2 的数据，发现删除失败，这是因为如果删除该记录就违背了已存在的外键约束。</p><p>很多时候需要进行联合跨表查询，比如想知道课程的名称，课程老师的名称，邮箱信息就需要联合查询：</p><pre><code class="hljs ruby"><span class="hljs-section">mysql&gt; select * from course join user on course.teacher_id = user.id;
+----+---------------+------------+----+-------+-----------------+</span>
<span class="hljs-section"><span class="hljs-params">| id |</span> name          <span class="hljs-params">| teacher_id |</span> id <span class="hljs-params">| name  |</span> email           <span class="hljs-params">|
+----+---------------+------------+----+-------+-----------------+</span></span><span class="hljs-params">
</span><span class="hljs-section"><span class="hljs-params">|</span>  <span class="hljs-number">2</span> <span class="hljs-params">| Python 基础   |</span>          <span class="hljs-number">2</span> <span class="hljs-params">|  2 |</span> lxttx <span class="hljs-params">| lxttx@gmail.com |</span>
+----+---------------+------------+----+-------+-----------------+</span>
<span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)
</code></pre><p>例子中使用 <code>join</code> 指令进行联合查询，<code>on</code> 关键字指定了两张表的关联方式。</p><p>MySQL 约束操作视频：</p><p><div tabindex="-1" id="vjs_video_753" data-setup="{&quot;fluid&quot;:true}" preload="auto" class="video-js vjs-default-skin vjs-paused vjs-fluid vjs_video_753-dimensions vjs-controls-enabled vjs-workinghover vjs-v6 vjs-user-inactive" lang="zh-cn" role="region" aria-label="Video Player"><video class="vjs-tech" preload="auto" data-setup="{&quot;fluid&quot;:true}" id="vjs_video_753_html5_api" tabindex="-1"><source src="https://labfile.oss.aliyuncs.com/courses/923/week2_mp4/2-2-3-mac.mp4" type="video/mp4"></video><div class="vjs-poster vjs-hidden" tabindex="-1" aria-disabled="false"></div><div class="vjs-text-track-display" aria-live="off" aria-atomic="true"></div><div class="vjs-loading-spinner" dir="ltr"></div><button class="vjs-big-play-button" type="button" aria-live="polite" title="Play Video" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Play Video</span></button><div class="vjs-control-bar" dir="ltr" role="group"><button class="vjs-play-control vjs-control vjs-button" type="button" aria-live="polite" title="Play" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Play</span></button><div class="vjs-volume-panel vjs-control vjs-volume-panel-horizontal"><button class="vjs-mute-control vjs-control vjs-button vjs-vol-3" type="button" aria-live="polite" title="Mute" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Mute</span></button><div class="vjs-volume-control vjs-control vjs-volume-horizontal"><div tabindex="0" class="vjs-volume-bar vjs-slider-bar vjs-slider vjs-slider-horizontal" role="slider" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" aria-label="Volume Level" aria-live="polite" aria-valuetext="100%"><div class="vjs-volume-level"><span class="vjs-control-text"></span></div></div></div></div><div class="vjs-current-time vjs-time-control vjs-control"><div class="vjs-current-time-display" aria-live="off"><span class="vjs-control-text">Current Time</span> 0:00</div></div><div class="vjs-time-control vjs-time-divider"><div><span>/</span></div></div><div class="vjs-duration vjs-time-control vjs-control"><div class="vjs-duration-display" aria-live="off"><span class="vjs-control-text">Duration Time</span> 9:02</div></div><div class="vjs-progress-control vjs-control"><div tabindex="0" class="vjs-progress-holder vjs-slider vjs-slider-horizontal" role="slider" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Progress Bar"><div class="vjs-load-progress" style="width: 0%;"><span class="vjs-control-text"><span>Loaded</span>: 0%</span><div style="left: 0%; width: 0%;"></div></div><div class="vjs-mouse-display"><div class="vjs-time-tooltip"></div></div><div class="vjs-play-progress vjs-slider-bar"><div class="vjs-time-tooltip"></div><span class="vjs-control-text"><span>Progress</span>: 0%</span></div></div></div><div class="vjs-live-control vjs-control vjs-hidden"><div class="vjs-live-display" aria-live="off"><span class="vjs-control-text">Stream Type</span>LIVE</div></div><div class="vjs-remaining-time vjs-time-control vjs-control"><div class="vjs-remaining-time-display" aria-live="off"><span class="vjs-control-text">Remaining Time</span> -9:02</div></div><div class="vjs-custom-control-spacer vjs-spacer ">&nbsp;</div><div class="vjs-playback-rate vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-playback-rate vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Playback Rate" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Playback Rate</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"></ul></div><div class="vjs-playback-rate-value">1x</div></div><div class="vjs-chapters-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-chapters-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Chapters" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Chapters</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-title" tabindex="-1">Chapters</li></ul></div></div><div class="vjs-descriptions-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-descriptions-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Descriptions" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Descriptions</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-item vjs-selected" tabindex="-1" role="menuitemcheckbox" aria-live="polite" aria-disabled="false" aria-checked="true"><span class="vjs-menu-item-text">descriptions off</span><span class="vjs-control-text">, selected</span></li></ul></div></div><div class="vjs-subs-caps-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-subs-caps-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Subtitles" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Subtitles</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-item vjs-texttrack-settings" tabindex="-1" role="menuitem" aria-live="polite" aria-disabled="false"><span class="vjs-menu-item-text">subtitles settings</span><span class="vjs-control-text">, opens subtitles settings dialog</span></li><li class="vjs-menu-item vjs-selected" tabindex="-1" role="menuitemcheckbox" aria-live="polite" aria-disabled="false" aria-checked="true"><span class="vjs-menu-item-text">subtitles off</span><span class="vjs-control-text">, selected</span></li></ul></div></div><div class="vjs-audio-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-audio-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Audio Track" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Audio Track</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"></ul></div></div><button class="vjs-fullscreen-control vjs-control vjs-button" type="button" aria-live="polite" title="Fullscreen" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Fullscreen</span></button></div><div class="vjs-error-display vjs-modal-dialog vjs-hidden " tabindex="-1" aria-describedby="vjs_video_753_component_1060_description" aria-hidden="true" aria-label="Modal Window" role="dialog"><p class="vjs-modal-dialog-description vjs-control-text" id="vjs_video_753_component_1060_description">This is a modal window.</p><div class="vjs-modal-dialog-content" role="document"></div></div><div class="vjs-modal-dialog vjs-hidden  vjs-text-track-settings" tabindex="-1" aria-describedby="vjs_video_753_component_1065_description" aria-hidden="true" aria-label="Caption Settings Dialog" role="dialog"><p class="vjs-modal-dialog-description vjs-control-text" id="vjs_video_753_component_1065_description">Beginning of dialog window. Escape will cancel and close the window.</p><div class="vjs-modal-dialog-content" role="document"><div class="vjs-track-settings-colors"><fieldset class="vjs-fg-color vjs-track-setting"><legend id="captions-text-legend-vjs_video_753_component_1065">Text</legend><label id="captions-foreground-color-vjs_video_753_component_1065" class="vjs-label">Color</label><select aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065"><option id="captions-foreground-color-vjs_video_753_component_1065-White" value="#FFF" aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065-White">White</option><option id="captions-foreground-color-vjs_video_753_component_1065-Black" value="#000" aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065-Black">Black</option><option id="captions-foreground-color-vjs_video_753_component_1065-Red" value="#F00" aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065-Red">Red</option><option id="captions-foreground-color-vjs_video_753_component_1065-Green" value="#0F0" aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065-Green">Green</option><option id="captions-foreground-color-vjs_video_753_component_1065-Blue" value="#00F" aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065-Blue">Blue</option><option id="captions-foreground-color-vjs_video_753_component_1065-Yellow" value="#FF0" aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065-Yellow">Yellow</option><option id="captions-foreground-color-vjs_video_753_component_1065-Magenta" value="#F0F" aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065-Magenta">Magenta</option><option id="captions-foreground-color-vjs_video_753_component_1065-Cyan" value="#0FF" aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065 captions-foreground-color-vjs_video_753_component_1065-Cyan">Cyan</option></select><span class="vjs-text-opacity vjs-opacity"><label id="captions-foreground-opacity-vjs_video_753_component_1065" class="vjs-label">Transparency</label><select aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-opacity-vjs_video_753_component_1065"><option id="captions-foreground-opacity-vjs_video_753_component_1065-Opaque" value="1" aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-opacity-vjs_video_753_component_1065 captions-foreground-opacity-vjs_video_753_component_1065-Opaque">Opaque</option><option id="captions-foreground-opacity-vjs_video_753_component_1065-Semi-Transparent" value="0.5" aria-labelledby="captions-text-legend-vjs_video_753_component_1065 captions-foreground-opacity-vjs_video_753_component_1065 captions-foreground-opacity-vjs_video_753_component_1065-Semi-Transparent">Semi-Transparent</option></select></span></fieldset><fieldset class="vjs-bg-color vjs-track-setting"><legend id="captions-background-vjs_video_753_component_1065">Background</legend><label id="captions-background-color-vjs_video_753_component_1065" class="vjs-label">Color</label><select aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065"><option id="captions-background-color-vjs_video_753_component_1065-Black" value="#000" aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065-Black">Black</option><option id="captions-background-color-vjs_video_753_component_1065-White" value="#FFF" aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065-White">White</option><option id="captions-background-color-vjs_video_753_component_1065-Red" value="#F00" aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065-Red">Red</option><option id="captions-background-color-vjs_video_753_component_1065-Green" value="#0F0" aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065-Green">Green</option><option id="captions-background-color-vjs_video_753_component_1065-Blue" value="#00F" aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065-Blue">Blue</option><option id="captions-background-color-vjs_video_753_component_1065-Yellow" value="#FF0" aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065-Yellow">Yellow</option><option id="captions-background-color-vjs_video_753_component_1065-Magenta" value="#F0F" aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065-Magenta">Magenta</option><option id="captions-background-color-vjs_video_753_component_1065-Cyan" value="#0FF" aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065 captions-background-color-vjs_video_753_component_1065-Cyan">Cyan</option></select><span class="vjs-bg-opacity vjs-opacity"><label id="captions-background-opacity-vjs_video_753_component_1065" class="vjs-label">Transparency</label><select aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-opacity-vjs_video_753_component_1065"><option id="captions-background-opacity-vjs_video_753_component_1065-Opaque" value="1" aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-opacity-vjs_video_753_component_1065 captions-background-opacity-vjs_video_753_component_1065-Opaque">Opaque</option><option id="captions-background-opacity-vjs_video_753_component_1065-Semi-Transparent" value="0.5" aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-opacity-vjs_video_753_component_1065 captions-background-opacity-vjs_video_753_component_1065-Semi-Transparent">Semi-Transparent</option><option id="captions-background-opacity-vjs_video_753_component_1065-Transparent" value="0" aria-labelledby="captions-background-vjs_video_753_component_1065 captions-background-opacity-vjs_video_753_component_1065 captions-background-opacity-vjs_video_753_component_1065-Transparent">Transparent</option></select></span></fieldset><fieldset class="vjs-window-color vjs-track-setting"><legend id="captions-window-vjs_video_753_component_1065">Window</legend><label id="captions-window-color-vjs_video_753_component_1065" class="vjs-label">Color</label><select aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065"><option id="captions-window-color-vjs_video_753_component_1065-Black" value="#000" aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065-Black">Black</option><option id="captions-window-color-vjs_video_753_component_1065-White" value="#FFF" aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065-White">White</option><option id="captions-window-color-vjs_video_753_component_1065-Red" value="#F00" aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065-Red">Red</option><option id="captions-window-color-vjs_video_753_component_1065-Green" value="#0F0" aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065-Green">Green</option><option id="captions-window-color-vjs_video_753_component_1065-Blue" value="#00F" aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065-Blue">Blue</option><option id="captions-window-color-vjs_video_753_component_1065-Yellow" value="#FF0" aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065-Yellow">Yellow</option><option id="captions-window-color-vjs_video_753_component_1065-Magenta" value="#F0F" aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065-Magenta">Magenta</option><option id="captions-window-color-vjs_video_753_component_1065-Cyan" value="#0FF" aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065 captions-window-color-vjs_video_753_component_1065-Cyan">Cyan</option></select><span class="vjs-window-opacity vjs-opacity"><label id="captions-window-opacity-vjs_video_753_component_1065" class="vjs-label">Transparency</label><select aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-opacity-vjs_video_753_component_1065"><option id="captions-window-opacity-vjs_video_753_component_1065-Transparent" value="0" aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-opacity-vjs_video_753_component_1065 captions-window-opacity-vjs_video_753_component_1065-Transparent">Transparent</option><option id="captions-window-opacity-vjs_video_753_component_1065-Semi-Transparent" value="0.5" aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-opacity-vjs_video_753_component_1065 captions-window-opacity-vjs_video_753_component_1065-Semi-Transparent">Semi-Transparent</option><option id="captions-window-opacity-vjs_video_753_component_1065-Opaque" value="1" aria-labelledby="captions-window-vjs_video_753_component_1065 captions-window-opacity-vjs_video_753_component_1065 captions-window-opacity-vjs_video_753_component_1065-Opaque">Opaque</option></select></span></fieldset></div><div class="vjs-track-settings-font&quot;>"><fieldset class="vjs-font-percent vjs-track-setting"><legend id="captions-font-size-vjs_video_753_component_1065" class="">Font Size</legend><select aria-labelledby=" captions-font-size-vjs_video_753_component_1065"><option id="captions-font-size-vjs_video_753_component_1065-50%" value="0.50" aria-labelledby=" captions-font-size-vjs_video_753_component_1065 captions-font-size-vjs_video_753_component_1065-50%">50%</option><option id="captions-font-size-vjs_video_753_component_1065-75%" value="0.75" aria-labelledby=" captions-font-size-vjs_video_753_component_1065 captions-font-size-vjs_video_753_component_1065-75%">75%</option><option id="captions-font-size-vjs_video_753_component_1065-100%" value="1.00" aria-labelledby=" captions-font-size-vjs_video_753_component_1065 captions-font-size-vjs_video_753_component_1065-100%">100%</option><option id="captions-font-size-vjs_video_753_component_1065-125%" value="1.25" aria-labelledby=" captions-font-size-vjs_video_753_component_1065 captions-font-size-vjs_video_753_component_1065-125%">125%</option><option id="captions-font-size-vjs_video_753_component_1065-150%" value="1.50" aria-labelledby=" captions-font-size-vjs_video_753_component_1065 captions-font-size-vjs_video_753_component_1065-150%">150%</option><option id="captions-font-size-vjs_video_753_component_1065-175%" value="1.75" aria-labelledby=" captions-font-size-vjs_video_753_component_1065 captions-font-size-vjs_video_753_component_1065-175%">175%</option><option id="captions-font-size-vjs_video_753_component_1065-200%" value="2.00" aria-labelledby=" captions-font-size-vjs_video_753_component_1065 captions-font-size-vjs_video_753_component_1065-200%">200%</option><option id="captions-font-size-vjs_video_753_component_1065-300%" value="3.00" aria-labelledby=" captions-font-size-vjs_video_753_component_1065 captions-font-size-vjs_video_753_component_1065-300%">300%</option><option id="captions-font-size-vjs_video_753_component_1065-400%" value="4.00" aria-labelledby=" captions-font-size-vjs_video_753_component_1065 captions-font-size-vjs_video_753_component_1065-400%">400%</option></select></fieldset><fieldset class="vjs-edge-style vjs-track-setting"><legend id="vjs_video_753_component_1065" class="">Text Edge Style</legend><select aria-labelledby=" vjs_video_753_component_1065"><option id="vjs_video_753_component_1065-None" value="none" aria-labelledby=" vjs_video_753_component_1065 vjs_video_753_component_1065-None">None</option><option id="vjs_video_753_component_1065-Raised" value="raised" aria-labelledby=" vjs_video_753_component_1065 vjs_video_753_component_1065-Raised">Raised</option><option id="vjs_video_753_component_1065-Depressed" value="depressed" aria-labelledby=" vjs_video_753_component_1065 vjs_video_753_component_1065-Depressed">Depressed</option><option id="vjs_video_753_component_1065-Uniform" value="uniform" aria-labelledby=" vjs_video_753_component_1065 vjs_video_753_component_1065-Uniform">Uniform</option><option id="vjs_video_753_component_1065-Dropshadow" value="dropshadow" aria-labelledby=" vjs_video_753_component_1065 vjs_video_753_component_1065-Dropshadow">Dropshadow</option></select></fieldset><fieldset class="vjs-font-family vjs-track-setting"><legend id="captions-font-family-vjs_video_753_component_1065" class="">Font Family</legend><select aria-labelledby=" captions-font-family-vjs_video_753_component_1065"><option id="captions-font-family-vjs_video_753_component_1065-Proportional Sans-Serif" value="proportionalSansSerif" aria-labelledby=" captions-font-family-vjs_video_753_component_1065 captions-font-family-vjs_video_753_component_1065-Proportional Sans-Serif">Proportional Sans-Serif</option><option id="captions-font-family-vjs_video_753_component_1065-Monospace Sans-Serif" value="monospaceSansSerif" aria-labelledby=" captions-font-family-vjs_video_753_component_1065 captions-font-family-vjs_video_753_component_1065-Monospace Sans-Serif">Monospace Sans-Serif</option><option id="captions-font-family-vjs_video_753_component_1065-Proportional Serif" value="proportionalSerif" aria-labelledby=" captions-font-family-vjs_video_753_component_1065 captions-font-family-vjs_video_753_component_1065-Proportional Serif">Proportional Serif</option><option id="captions-font-family-vjs_video_753_component_1065-Monospace Serif" value="monospaceSerif" aria-labelledby=" captions-font-family-vjs_video_753_component_1065 captions-font-family-vjs_video_753_component_1065-Monospace Serif">Monospace Serif</option><option id="captions-font-family-vjs_video_753_component_1065-Casual" value="casual" aria-labelledby=" captions-font-family-vjs_video_753_component_1065 captions-font-family-vjs_video_753_component_1065-Casual">Casual</option><option id="captions-font-family-vjs_video_753_component_1065-Script" value="script" aria-labelledby=" captions-font-family-vjs_video_753_component_1065 captions-font-family-vjs_video_753_component_1065-Script">Script</option><option id="captions-font-family-vjs_video_753_component_1065-Small Caps" value="small-caps" aria-labelledby=" captions-font-family-vjs_video_753_component_1065 captions-font-family-vjs_video_753_component_1065-Small Caps">Small Caps</option></select></fieldset></div><div class="vjs-track-settings-controls"><button class="vjs-default-button" title="restore all settings to the default values">Reset<span class="vjs-control-text"> restore all settings to the default values</span></button><button class="vjs-done-button">Done</button></div></div><button class="vjs-close-button vjs-control vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Close Modal Dialog"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Close Modal Dialog</span></button><p class="vjs-control-text">End of dialog window.</p></div></div></p><h3 id="labdoc-header-6">总结</h3>
<p>学习完以上内容，我们已经能够进行 MySQL 的基本操作了。MySQL 博大精深，涉及的知识点非常多，比如上面的内容就没有涉及索引管理和性能优化方面的内容。如果想学习更多的 MySQL 内容，一方面可以在实验楼学习其他课程，另一方面要多查阅 <a href="https://dev.mysql.com/doc/" target="_blank">MySQL 文档</a>。</p><h2 id="labdoc-header-7">SQLAlchemy</h2>
<p>在实际项目中，一般都不直接写 SQL 语句访问数据库，而是通过 ORM 工具。ORM 全称是对象关系映射（Object Relational Mapping），有了 ORM 以后可以将 Python 对象映射到数据库中，这样就不用再编写各种 SQL 语句了。而在 Python 语言中，SQLAlchemy 是非常强大的 ORM 包，非常值得学习。同时 SQLAlchemy 支持多种关系数据，如果项目后期需要切换到其他类型的数据库，通过 SQLAlchemy 也比较容易。</p><p><img src="https://dn-anything-about-doc.qbox.me/document-uid18510labid2382timestamp1501149470960.png/wm" alt=""></p><h3 id="labdoc-header-8">环境准备</h3>
<p>本节实验环境主要基于 <code>virtualenv</code> 建立。<code>virtualenv</code> 的作用很重要，可以理解为一个隔离的虚拟环境，安装在 virtualenv 下的包不会影响整个系统的包，避免不同版本包之间的影响，不需要太深入只需要知道如何创建及激活、退出（deactivate命令）就可以。</p><p>使用 virtualenv 的时候需要注意，当在 virtualenv 下安装了包之后，需要先用 <code>deactivate</code> 命令退出 virtualenv 后再重新激活 virtualenv 才可以用这个包。</p><p>打开桌面上的终端后，依次输入下面的命令建立学习环境(<code>$</code> 是 shell 提示符，之后的内容才是真正需要输入的命令)：</p><pre><code class="hljs sql"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/Code</span>
<span class="hljs-meta">$</span><span class="bash"> sudo pip <span class="hljs-keyword">install</span> virtualenv</span>
<span class="hljs-meta">$</span><span class="bash"> virtualenv -p /usr/<span class="hljs-keyword">bin</span>/python3<span class="hljs-number">.5</span> env</span>
<span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in"><span class="hljs-keyword">source</span></span> env/<span class="hljs-keyword">bin</span>/<span class="hljs-keyword">activate</span></span>
<span class="hljs-meta">$</span><span class="bash"> pip <span class="hljs-keyword">install</span> sqlalchemy ipython mysqlclient</span>
<span class="hljs-meta">$</span><span class="bash"> deactivate</span>
</code></pre><p>以上命令在 <code>Code</code> 目录创建一个 <code>virtualenv</code> 环境，接着在这个虚拟环境中安装了本节实验需要的软件包，比如 <code>sqlalchemy</code> 和 <code>ipython</code>，然后使用 <code>deactivate</code> 退出 env。后续的交互式命令都通过 <code>IPython</code> 终端输入。 可以通过以下命令启动 IPython 终端：</p><pre><code class="hljs ruby"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> env/bin/activate</span>
<span class="hljs-meta">$</span><span class="bash"> ipython</span>
</code></pre><p>IPython是一个交互式计算系统，类似于我们之前使用的 Python 3 交互式环境，但是一个具备更多便利功能的增加的交互式 “Python shell”。主要优点包括：</p><ol>
<li>可以非常方便获取代码中对象的各种信息</li>
<li>可以使用叹号直接在其中调用 Linux 的命令</li>
<li>支持 TAB 自动补全代码</li>
<li>输入的代码都保存到历史记录数据库里</li>
</ol>
<p>因此，如果你对 IPython 熟悉的话，会逐步替代先前使用的 Python Shell。</p><p>后文出现的代码中， <code>In [1]</code> 类似样式的字符是 IPython 的提示符，不需要输入。</p><p>virtualenv 及 IPython 操作视频：</p><p><div tabindex="-1" id="vjs_video_1096" data-setup="{&quot;fluid&quot;:true}" preload="auto" class="video-js vjs-default-skin vjs-paused vjs-fluid vjs_video_1096-dimensions vjs-controls-enabled vjs-workinghover vjs-v6 vjs-user-inactive" lang="zh-cn" role="region" aria-label="Video Player"><video class="vjs-tech" preload="auto" data-setup="{&quot;fluid&quot;:true}" id="vjs_video_1096_html5_api" tabindex="-1"><source src="https://labfile.oss.aliyuncs.com/courses/923/week2_mp4/2-2-4-mac.mp4" type="video/mp4"></video><div class="vjs-poster vjs-hidden" tabindex="-1" aria-disabled="false"></div><div class="vjs-text-track-display" aria-live="off" aria-atomic="true"></div><div class="vjs-loading-spinner" dir="ltr"></div><button class="vjs-big-play-button" type="button" aria-live="polite" title="Play Video" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Play Video</span></button><div class="vjs-control-bar" dir="ltr" role="group"><button class="vjs-play-control vjs-control vjs-button" type="button" aria-live="polite" title="Play" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Play</span></button><div class="vjs-volume-panel vjs-control vjs-volume-panel-horizontal"><button class="vjs-mute-control vjs-control vjs-button vjs-vol-3" type="button" aria-live="polite" title="Mute" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Mute</span></button><div class="vjs-volume-control vjs-control vjs-volume-horizontal"><div tabindex="0" class="vjs-volume-bar vjs-slider-bar vjs-slider vjs-slider-horizontal" role="slider" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" aria-label="Volume Level" aria-live="polite" aria-valuetext="100%"><div class="vjs-volume-level"><span class="vjs-control-text"></span></div></div></div></div><div class="vjs-current-time vjs-time-control vjs-control"><div class="vjs-current-time-display" aria-live="off"><span class="vjs-control-text">Current Time</span> 0:00</div></div><div class="vjs-time-control vjs-time-divider"><div><span>/</span></div></div><div class="vjs-duration vjs-time-control vjs-control"><div class="vjs-duration-display" aria-live="off"><span class="vjs-control-text">Duration Time</span> 0:00</div></div><div class="vjs-progress-control vjs-control"><div tabindex="0" class="vjs-progress-holder vjs-slider vjs-slider-horizontal" role="slider" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Progress Bar"><div class="vjs-load-progress"><span class="vjs-control-text"><span>Loaded</span>: 0%</span></div><div class="vjs-mouse-display"><div class="vjs-time-tooltip"></div></div><div class="vjs-play-progress vjs-slider-bar"><div class="vjs-time-tooltip"></div><span class="vjs-control-text"><span>Progress</span>: 0%</span></div></div></div><div class="vjs-live-control vjs-control vjs-hidden"><div class="vjs-live-display" aria-live="off"><span class="vjs-control-text">Stream Type</span>LIVE</div></div><div class="vjs-remaining-time vjs-time-control vjs-control"><div class="vjs-remaining-time-display" aria-live="off"><span class="vjs-control-text">Remaining Time</span> -0:00</div></div><div class="vjs-custom-control-spacer vjs-spacer ">&nbsp;</div><div class="vjs-playback-rate vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-playback-rate vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Playback Rate" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Playback Rate</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"></ul></div><div class="vjs-playback-rate-value">1x</div></div><div class="vjs-chapters-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-chapters-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Chapters" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Chapters</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-title" tabindex="-1">Chapters</li></ul></div></div><div class="vjs-descriptions-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-descriptions-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Descriptions" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Descriptions</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-item vjs-selected" tabindex="-1" role="menuitemcheckbox" aria-live="polite" aria-disabled="false" aria-checked="true"><span class="vjs-menu-item-text">descriptions off</span><span class="vjs-control-text">, selected</span></li></ul></div></div><div class="vjs-subs-caps-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-subs-caps-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Subtitles" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Subtitles</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"><li class="vjs-menu-item vjs-texttrack-settings" tabindex="-1" role="menuitem" aria-live="polite" aria-disabled="false"><span class="vjs-menu-item-text">subtitles settings</span><span class="vjs-control-text">, opens subtitles settings dialog</span></li><li class="vjs-menu-item vjs-selected" tabindex="-1" role="menuitemcheckbox" aria-live="polite" aria-disabled="false" aria-checked="true"><span class="vjs-menu-item-text">subtitles off</span><span class="vjs-control-text">, selected</span></li></ul></div></div><div class="vjs-audio-button vjs-menu-button vjs-menu-button-popup vjs-control vjs-button vjs-hidden"><button class="vjs-audio-button vjs-menu-button vjs-menu-button-popup vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Audio Track" aria-haspopup="true" aria-expanded="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Audio Track</span></button><div class="vjs-menu"><ul class="vjs-menu-content" role="menu"></ul></div></div><button class="vjs-fullscreen-control vjs-control vjs-button" type="button" aria-live="polite" title="Fullscreen" aria-disabled="false"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Fullscreen</span></button></div><div class="vjs-error-display vjs-modal-dialog vjs-hidden " tabindex="-1" aria-describedby="vjs_video_1096_component_1403_description" aria-hidden="true" aria-label="Modal Window" role="dialog"><p class="vjs-modal-dialog-description vjs-control-text" id="vjs_video_1096_component_1403_description">This is a modal window.</p><div class="vjs-modal-dialog-content" role="document"></div></div><div class="vjs-modal-dialog vjs-hidden  vjs-text-track-settings" tabindex="-1" aria-describedby="vjs_video_1096_component_1408_description" aria-hidden="true" aria-label="Caption Settings Dialog" role="dialog"><p class="vjs-modal-dialog-description vjs-control-text" id="vjs_video_1096_component_1408_description">Beginning of dialog window. Escape will cancel and close the window.</p><div class="vjs-modal-dialog-content" role="document"><div class="vjs-track-settings-colors"><fieldset class="vjs-fg-color vjs-track-setting"><legend id="captions-text-legend-vjs_video_1096_component_1408">Text</legend><label id="captions-foreground-color-vjs_video_1096_component_1408" class="vjs-label">Color</label><select aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408"><option id="captions-foreground-color-vjs_video_1096_component_1408-White" value="#FFF" aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408-White">White</option><option id="captions-foreground-color-vjs_video_1096_component_1408-Black" value="#000" aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408-Black">Black</option><option id="captions-foreground-color-vjs_video_1096_component_1408-Red" value="#F00" aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408-Red">Red</option><option id="captions-foreground-color-vjs_video_1096_component_1408-Green" value="#0F0" aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408-Green">Green</option><option id="captions-foreground-color-vjs_video_1096_component_1408-Blue" value="#00F" aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408-Blue">Blue</option><option id="captions-foreground-color-vjs_video_1096_component_1408-Yellow" value="#FF0" aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408-Yellow">Yellow</option><option id="captions-foreground-color-vjs_video_1096_component_1408-Magenta" value="#F0F" aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408-Magenta">Magenta</option><option id="captions-foreground-color-vjs_video_1096_component_1408-Cyan" value="#0FF" aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408 captions-foreground-color-vjs_video_1096_component_1408-Cyan">Cyan</option></select><span class="vjs-text-opacity vjs-opacity"><label id="captions-foreground-opacity-vjs_video_1096_component_1408" class="vjs-label">Transparency</label><select aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-opacity-vjs_video_1096_component_1408"><option id="captions-foreground-opacity-vjs_video_1096_component_1408-Opaque" value="1" aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-opacity-vjs_video_1096_component_1408 captions-foreground-opacity-vjs_video_1096_component_1408-Opaque">Opaque</option><option id="captions-foreground-opacity-vjs_video_1096_component_1408-Semi-Transparent" value="0.5" aria-labelledby="captions-text-legend-vjs_video_1096_component_1408 captions-foreground-opacity-vjs_video_1096_component_1408 captions-foreground-opacity-vjs_video_1096_component_1408-Semi-Transparent">Semi-Transparent</option></select></span></fieldset><fieldset class="vjs-bg-color vjs-track-setting"><legend id="captions-background-vjs_video_1096_component_1408">Background</legend><label id="captions-background-color-vjs_video_1096_component_1408" class="vjs-label">Color</label><select aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408"><option id="captions-background-color-vjs_video_1096_component_1408-Black" value="#000" aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408-Black">Black</option><option id="captions-background-color-vjs_video_1096_component_1408-White" value="#FFF" aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408-White">White</option><option id="captions-background-color-vjs_video_1096_component_1408-Red" value="#F00" aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408-Red">Red</option><option id="captions-background-color-vjs_video_1096_component_1408-Green" value="#0F0" aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408-Green">Green</option><option id="captions-background-color-vjs_video_1096_component_1408-Blue" value="#00F" aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408-Blue">Blue</option><option id="captions-background-color-vjs_video_1096_component_1408-Yellow" value="#FF0" aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408-Yellow">Yellow</option><option id="captions-background-color-vjs_video_1096_component_1408-Magenta" value="#F0F" aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408-Magenta">Magenta</option><option id="captions-background-color-vjs_video_1096_component_1408-Cyan" value="#0FF" aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408 captions-background-color-vjs_video_1096_component_1408-Cyan">Cyan</option></select><span class="vjs-bg-opacity vjs-opacity"><label id="captions-background-opacity-vjs_video_1096_component_1408" class="vjs-label">Transparency</label><select aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-opacity-vjs_video_1096_component_1408"><option id="captions-background-opacity-vjs_video_1096_component_1408-Opaque" value="1" aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-opacity-vjs_video_1096_component_1408 captions-background-opacity-vjs_video_1096_component_1408-Opaque">Opaque</option><option id="captions-background-opacity-vjs_video_1096_component_1408-Semi-Transparent" value="0.5" aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-opacity-vjs_video_1096_component_1408 captions-background-opacity-vjs_video_1096_component_1408-Semi-Transparent">Semi-Transparent</option><option id="captions-background-opacity-vjs_video_1096_component_1408-Transparent" value="0" aria-labelledby="captions-background-vjs_video_1096_component_1408 captions-background-opacity-vjs_video_1096_component_1408 captions-background-opacity-vjs_video_1096_component_1408-Transparent">Transparent</option></select></span></fieldset><fieldset class="vjs-window-color vjs-track-setting"><legend id="captions-window-vjs_video_1096_component_1408">Window</legend><label id="captions-window-color-vjs_video_1096_component_1408" class="vjs-label">Color</label><select aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408"><option id="captions-window-color-vjs_video_1096_component_1408-Black" value="#000" aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408-Black">Black</option><option id="captions-window-color-vjs_video_1096_component_1408-White" value="#FFF" aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408-White">White</option><option id="captions-window-color-vjs_video_1096_component_1408-Red" value="#F00" aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408-Red">Red</option><option id="captions-window-color-vjs_video_1096_component_1408-Green" value="#0F0" aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408-Green">Green</option><option id="captions-window-color-vjs_video_1096_component_1408-Blue" value="#00F" aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408-Blue">Blue</option><option id="captions-window-color-vjs_video_1096_component_1408-Yellow" value="#FF0" aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408-Yellow">Yellow</option><option id="captions-window-color-vjs_video_1096_component_1408-Magenta" value="#F0F" aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408-Magenta">Magenta</option><option id="captions-window-color-vjs_video_1096_component_1408-Cyan" value="#0FF" aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408 captions-window-color-vjs_video_1096_component_1408-Cyan">Cyan</option></select><span class="vjs-window-opacity vjs-opacity"><label id="captions-window-opacity-vjs_video_1096_component_1408" class="vjs-label">Transparency</label><select aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-opacity-vjs_video_1096_component_1408"><option id="captions-window-opacity-vjs_video_1096_component_1408-Transparent" value="0" aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-opacity-vjs_video_1096_component_1408 captions-window-opacity-vjs_video_1096_component_1408-Transparent">Transparent</option><option id="captions-window-opacity-vjs_video_1096_component_1408-Semi-Transparent" value="0.5" aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-opacity-vjs_video_1096_component_1408 captions-window-opacity-vjs_video_1096_component_1408-Semi-Transparent">Semi-Transparent</option><option id="captions-window-opacity-vjs_video_1096_component_1408-Opaque" value="1" aria-labelledby="captions-window-vjs_video_1096_component_1408 captions-window-opacity-vjs_video_1096_component_1408 captions-window-opacity-vjs_video_1096_component_1408-Opaque">Opaque</option></select></span></fieldset></div><div class="vjs-track-settings-font&quot;>"><fieldset class="vjs-font-percent vjs-track-setting"><legend id="captions-font-size-vjs_video_1096_component_1408" class="">Font Size</legend><select aria-labelledby=" captions-font-size-vjs_video_1096_component_1408"><option id="captions-font-size-vjs_video_1096_component_1408-50%" value="0.50" aria-labelledby=" captions-font-size-vjs_video_1096_component_1408 captions-font-size-vjs_video_1096_component_1408-50%">50%</option><option id="captions-font-size-vjs_video_1096_component_1408-75%" value="0.75" aria-labelledby=" captions-font-size-vjs_video_1096_component_1408 captions-font-size-vjs_video_1096_component_1408-75%">75%</option><option id="captions-font-size-vjs_video_1096_component_1408-100%" value="1.00" aria-labelledby=" captions-font-size-vjs_video_1096_component_1408 captions-font-size-vjs_video_1096_component_1408-100%">100%</option><option id="captions-font-size-vjs_video_1096_component_1408-125%" value="1.25" aria-labelledby=" captions-font-size-vjs_video_1096_component_1408 captions-font-size-vjs_video_1096_component_1408-125%">125%</option><option id="captions-font-size-vjs_video_1096_component_1408-150%" value="1.50" aria-labelledby=" captions-font-size-vjs_video_1096_component_1408 captions-font-size-vjs_video_1096_component_1408-150%">150%</option><option id="captions-font-size-vjs_video_1096_component_1408-175%" value="1.75" aria-labelledby=" captions-font-size-vjs_video_1096_component_1408 captions-font-size-vjs_video_1096_component_1408-175%">175%</option><option id="captions-font-size-vjs_video_1096_component_1408-200%" value="2.00" aria-labelledby=" captions-font-size-vjs_video_1096_component_1408 captions-font-size-vjs_video_1096_component_1408-200%">200%</option><option id="captions-font-size-vjs_video_1096_component_1408-300%" value="3.00" aria-labelledby=" captions-font-size-vjs_video_1096_component_1408 captions-font-size-vjs_video_1096_component_1408-300%">300%</option><option id="captions-font-size-vjs_video_1096_component_1408-400%" value="4.00" aria-labelledby=" captions-font-size-vjs_video_1096_component_1408 captions-font-size-vjs_video_1096_component_1408-400%">400%</option></select></fieldset><fieldset class="vjs-edge-style vjs-track-setting"><legend id="vjs_video_1096_component_1408" class="">Text Edge Style</legend><select aria-labelledby=" vjs_video_1096_component_1408"><option id="vjs_video_1096_component_1408-None" value="none" aria-labelledby=" vjs_video_1096_component_1408 vjs_video_1096_component_1408-None">None</option><option id="vjs_video_1096_component_1408-Raised" value="raised" aria-labelledby=" vjs_video_1096_component_1408 vjs_video_1096_component_1408-Raised">Raised</option><option id="vjs_video_1096_component_1408-Depressed" value="depressed" aria-labelledby=" vjs_video_1096_component_1408 vjs_video_1096_component_1408-Depressed">Depressed</option><option id="vjs_video_1096_component_1408-Uniform" value="uniform" aria-labelledby=" vjs_video_1096_component_1408 vjs_video_1096_component_1408-Uniform">Uniform</option><option id="vjs_video_1096_component_1408-Dropshadow" value="dropshadow" aria-labelledby=" vjs_video_1096_component_1408 vjs_video_1096_component_1408-Dropshadow">Dropshadow</option></select></fieldset><fieldset class="vjs-font-family vjs-track-setting"><legend id="captions-font-family-vjs_video_1096_component_1408" class="">Font Family</legend><select aria-labelledby=" captions-font-family-vjs_video_1096_component_1408"><option id="captions-font-family-vjs_video_1096_component_1408-Proportional Sans-Serif" value="proportionalSansSerif" aria-labelledby=" captions-font-family-vjs_video_1096_component_1408 captions-font-family-vjs_video_1096_component_1408-Proportional Sans-Serif">Proportional Sans-Serif</option><option id="captions-font-family-vjs_video_1096_component_1408-Monospace Sans-Serif" value="monospaceSansSerif" aria-labelledby=" captions-font-family-vjs_video_1096_component_1408 captions-font-family-vjs_video_1096_component_1408-Monospace Sans-Serif">Monospace Sans-Serif</option><option id="captions-font-family-vjs_video_1096_component_1408-Proportional Serif" value="proportionalSerif" aria-labelledby=" captions-font-family-vjs_video_1096_component_1408 captions-font-family-vjs_video_1096_component_1408-Proportional Serif">Proportional Serif</option><option id="captions-font-family-vjs_video_1096_component_1408-Monospace Serif" value="monospaceSerif" aria-labelledby=" captions-font-family-vjs_video_1096_component_1408 captions-font-family-vjs_video_1096_component_1408-Monospace Serif">Monospace Serif</option><option id="captions-font-family-vjs_video_1096_component_1408-Casual" value="casual" aria-labelledby=" captions-font-family-vjs_video_1096_component_1408 captions-font-family-vjs_video_1096_component_1408-Casual">Casual</option><option id="captions-font-family-vjs_video_1096_component_1408-Script" value="script" aria-labelledby=" captions-font-family-vjs_video_1096_component_1408 captions-font-family-vjs_video_1096_component_1408-Script">Script</option><option id="captions-font-family-vjs_video_1096_component_1408-Small Caps" value="small-caps" aria-labelledby=" captions-font-family-vjs_video_1096_component_1408 captions-font-family-vjs_video_1096_component_1408-Small Caps">Small Caps</option></select></fieldset></div><div class="vjs-track-settings-controls"><button class="vjs-default-button" title="restore all settings to the default values">Reset<span class="vjs-control-text"> restore all settings to the default values</span></button><button class="vjs-done-button">Done</button></div></div><button class="vjs-close-button vjs-control vjs-button" type="button" aria-live="polite" aria-disabled="false" title="Close Modal Dialog"><span aria-hidden="true" class="vjs-icon-placeholder"></span><span class="vjs-control-text">Close Modal Dialog</span></button><p class="vjs-control-text">End of dialog window.</p></div></div></p><p>后续的 SQLAlchemy 基本操作都提供了详细的操作代码和预期的结果，不涉及到难以理解的操作内容，操作过程中需要细心理解 sqlalchemy 模块中每个类及函数的作用。</p><p>注意：在 ipython 中连续键入两个回车换行就会进入一个新的输入，这个时候如果你的类还没有写完，那么不要连续键入两次回车。</p><h3 id="labdoc-header-9">连接数据库</h3>
<p>使用 SQLAlchemy 连接数据库主要通过 <code>Engine</code> 对象进行，在 IPython 终端中输入以下代码：</p><pre><code class="hljs nginx"><span class="hljs-keyword"><span class="hljs-attribute">In</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>]: <span class="hljs-keyword">from</span> sqlalchemy import create_engine

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">2</span></span>]: engine = create_engine(<span class="hljs-string"><span class="hljs-string">'mysql://root:<span class="hljs-variable">@localhost</span>/shiyanlou'</span></span>)

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">3</span></span>]: engine.execute(<span class="hljs-string"><span class="hljs-string">'select * from user'</span></span>).fetchall()
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">3</span></span>]: [(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'aiden'</span></span>, <span class="hljs-string"><span class="hljs-string">'luojin<span class="hljs-variable">@simplecloud</span>.cn'</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'lxttx'</span></span>, <span class="hljs-string"><span class="hljs-string">'lxttx<span class="hljs-variable">@gmail</span>.com'</span></span>)]
</code></pre><p>首先导入了 <code>create_engine</code>, 该方法用于创建 <code>Engine</code> 实例，传递给 <code>create_engine</code> 的参数定义了 <code>MySQL</code> 服务器的访问地址，其格式为 <code>mysql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;/&lt;db_name&gt;</code>，例子中访问的正是上文中创建的 <code>shiyanlou</code> 数据库。</p><p>接着通过 <code>engine.execute</code> 方法执行了一条 SQL 语句，查询了 <code>user</code> 表中的所有用户，非常容易。</p><h3 id="labdoc-header-10">对象关系映射</h3>
<p>如果想使 Python 类映射到数据库表中，需要基于 SQLAlchemy 的 declarative base class，也就是声明基类创建类。当基于此基类，创建 Python 类时，就会自动映射到相应的数据库表上。创建声明基类，可以通过 <code>declarative_base</code> 方法进行，如下代码：</p><pre><code class="hljs coffeescript"><span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">12</span></span>]: <span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> declarative_base

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">13</span></span>]: Base = declarative_base()
</code></pre><p>创建基类以后，在 IPython 终端中输入下面代码，创建 <code>User</code> 类，该类将映射到上文中创建的 <code>user</code> 表：</p><pre><code class="hljs python"><span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">19</span></span>]: <span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> <span class="hljs-keyword">Column</span>, <span class="hljs-keyword">Integer</span>, <span class="hljs-keyword">String</span>

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">20</span></span>]: <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span><span class="hljs-params">(Base)</span>:</span>
    ...:     __tablename__ = <span class="hljs-string"><span class="hljs-string">'user'</span></span>
    ...:     id = <span class="hljs-keyword">Column</span>(<span class="hljs-keyword">Integer</span>, primary_key=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)
    ...:     name = <span class="hljs-keyword">Column</span>(<span class="hljs-keyword">String</span>)
    ...:     email = <span class="hljs-keyword">Column</span>(<span class="hljs-keyword">String</span>)
    ...:     <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span><span class="hljs-params">(self)</span>:</span>
    ...:         <span class="hljs-keyword">return</span> <span class="hljs-string"><span class="hljs-string">"&lt;User(name=%s)&gt;"</span></span> % self.name
    ...: 

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">21</span></span>]:
</code></pre><p>以上代码执行以后就成功定义了 <code>User</code> 类，注意 <code>__repr__</code> 前后各有两个下划线，这种前后有两个下划线的函数表示一个特殊的函数，称为 Python 类的<code>魔法方法</code>，<code>__init__</code> 也是一个魔法方法，这里 <code>__repr__</code> 方法会在直接调用实例对象的时候被调用。其中，<code>__tablename__</code> 对应着表名。</p><p>此时 <code>User</code> 有一个 <code>__table__</code> 属性，记录了定义的表信息，该属性如下所示：</p><pre><code class="hljs python"><span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">27</span></span>]: User.__table__
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">27</span></span>]: <span class="hljs-keyword">Table</span>(<span class="hljs-string"><span class="hljs-string">'user'</span></span>, MetaData(bind=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>), <span class="hljs-keyword">Column</span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-keyword">Integer</span>(), table=&lt;user&gt;, primary_key=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, nullable=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>), <span class="hljs-keyword">Column</span>(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-keyword">String</span>(), table=&lt;user&gt;), <span class="hljs-keyword">Column</span>(<span class="hljs-string"><span class="hljs-string">'email'</span></span>, <span class="hljs-keyword">String</span>(), table=&lt;user&gt;), schema=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>)
</code></pre><p>如果想通过 <code>User</code> 查询数据库该怎么办呢？需要先引入 <code>Session</code>。Session 是映射类和数据库沟通的桥梁，包含事务管理功能。通过以下代码创建 Session:</p><pre><code class="hljs coffeescript"><span class="hljs-keyword">In</span> [<span class="hljs-number">30</span>]: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker

<span class="hljs-keyword">In</span> [<span class="hljs-number">31</span>]: Session = sessionmaker(<span class="hljs-attribute">bind</span>=engine)

<span class="hljs-keyword">In</span> [<span class="hljs-number">32</span>]: session = Session()
</code></pre><p>这里的代码先从 sqlalchemy.orm 中导入 sessionmaker，然后创建了 sessionmaker 对象 Session，其中 Session 对象中有一个魔法方法（<code>__call__</code>），这个魔法方法让 Session 对象可以像函数那样调用，从而使用 <code>Session()</code> 获得了 session 对象。</p><p>Session 创建成功以后，就可以查询用户了，主要通过 <code>session.query</code> 方法：</p><pre><code class="hljs xml">In [<span class="hljs-number">63</span>]: session.query(User).all()
Out[<span class="hljs-number">63</span>]: <span class="hljs-meta">[<span class="hljs-tag">&lt;<span class="hljs-name">User(name=aiden)</span>&gt;</span>, <span class="hljs-tag">&lt;<span class="hljs-name">User(name=lxttx)</span>&gt;</span>]</span>

In [<span class="hljs-number">65</span>]: session.query(User).filter(User.name=='aiden').first()
Out[<span class="hljs-number">65</span>]: <span class="hljs-tag">&lt;<span class="hljs-name">User(name=aiden)</span>&gt;</span>
</code></pre><p>可以看到查询成功，而且可以直接使用 <code>User</code> 类的字段进行过滤查询。</p><p>如果在上文中创建 Engine 时，通过 <code>echo</code> 参数开启了显示 SQL 语句（<code>engine = create_engine('mysql://root:@localhost/shiyanlou', echo=True)</code>），则使用 session 查询时，可以看到相应的 SQL 输出：</p><pre><code class="hljs sql">In [69]: session.query(User).filter(User.name=='aiden').first()
2017-08-30 18:02:37,878 INFO sqlalchemy.engine.base.Engine <span class="hljs-keyword"><span class="hljs-keyword">SHOW</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VARIABLES</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'sql_mode'</span></span>
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">878</span></span> INFO sqlalchemy.engine.base.Engine ()
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">883</span></span> INFO sqlalchemy.engine.base.Engine <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span>()
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">883</span></span> INFO sqlalchemy.engine.base.Engine ()
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">885</span></span> INFO sqlalchemy.engine.base.Engine <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">collation</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-string"><span class="hljs-string">`Charset`</span></span> = <span class="hljs-string"><span class="hljs-string">'utf8'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-string"><span class="hljs-string">`Collation`</span></span> = <span class="hljs-string"><span class="hljs-string">'utf8_bin'</span></span>
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">885</span></span> INFO sqlalchemy.engine.base.Engine ()
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">889</span></span> INFO sqlalchemy.engine.base.Engine <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(<span class="hljs-string"><span class="hljs-string">'test plain returns'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> anon_1
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">889</span></span> INFO sqlalchemy.engine.base.Engine ()
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">893</span></span> INFO sqlalchemy.engine.base.Engine <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(<span class="hljs-string"><span class="hljs-string">'test unicode returns'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> anon_1
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">893</span></span> INFO sqlalchemy.engine.base.Engine ()
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">895</span></span> INFO sqlalchemy.engine.base.Engine <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(<span class="hljs-string"><span class="hljs-string">'test collated returns'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8) <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_bin <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> anon_1
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">895</span></span> INFO sqlalchemy.engine.base.Engine ()
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">897</span></span> INFO sqlalchemy.engine.base.Engine <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> (implicit)
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">898</span></span> INFO sqlalchemy.engine.base.Engine <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> user.id <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> user_id, user.name <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> user_name, user.email <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> user_email
<span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> user.name = %s
 <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> %s
<span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-30</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>,<span class="hljs-number"><span class="hljs-number">899</span></span> INFO sqlalchemy.engine.base.Engine (<span class="hljs-string"><span class="hljs-string">'aiden'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)
<span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>[<span class="hljs-number"><span class="hljs-number">69</span></span>]: &lt;<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=aiden)&gt;
</code></pre><p>在上面的查询过程中我们使用到了 filter 对数据进行筛选。filter 中的运算符可以填入 SQL WHERE 子句中的运算符（像 ==, !=, &gt;, &lt; 等），或者是 AND, OR 等运算符。另外，这里的 filter 也可以更换为 filter_by 函数，后者相对于前者没有那么灵活，一般会推荐使用 filter。</p><p>关于 SQL 语句，可以参考：</p><ul>
<li>拓展阅读 <a href="http://www.w3school.com.cn/sql/sql_where.asp" target="_blank">《W3school 教程 - SQL WHERE 子句》</a></li>
</ul>
<h3 id="labdoc-header-11">创建数据库表</h3>
<p>可以基于 SQLAlchemy 定义的类中生成数据库表，下面尝试创建一个新的实验表 <code>lab</code>，一个课程将对应于多个实验。所以课程表 <code>course</code> 和 <code>lab</code> 表是 1:M 一对多的关系。在定义 <code>Lab</code> 类之前，需要先将创建 <code>Course</code> 类，使其映射到之前定义的 <code>course</code> 表：</p><pre><code class="hljs python">In [<span class="hljs-number"><span class="hljs-number">80</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sqlalchemy.orm <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> relationship

In [<span class="hljs-number"><span class="hljs-number">81</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sqlalchemy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ForeignKey

In [<span class="hljs-number"><span class="hljs-number">84</span></span>]: <span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> <span class="hljs-title">Course</span><span class="hljs-params">(Base)</span>:</span>
    ...:     __tablename__ = <span class="hljs-string"><span class="hljs-string">'course'</span></span>
    ...:     id = Column(Integer, primary_key=<span class="hljs-literal"><span class="hljs-keyword">True</span></span>)
    ...:     name = Column(String)
    ...:     teacher_id = Column(Integer, ForeignKey(<span class="hljs-string"><span class="hljs-string">'user.id'</span></span>))
    ...:     teacher = relationship(<span class="hljs-string"><span class="hljs-string">'User'</span></span>)
    ...:     <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span><span class="hljs-params">(self)</span>:</span>
    ...:         <span class="hljs-keyword">return</span> <span class="hljs-string"><span class="hljs-string">'&lt;Course(name=%s)&gt;'</span></span> % self.name
    ...:
</code></pre><p>上面的代码引入了一些新的东西。前文中创建的 <code>course</code> 表有外键 <code>teacher_id</code>, 在 SQLAlchemy 中可以使用 <code>ForeignKey</code> 设置外键。设置外键后，如果能够直接从 <code>Course</code> 的实例上访问到相应的 <code>user</code> 表中的记录会非常方便，而这可以通过 <code>relationship</code> 实现。上面的代码通过 <code>relationship</code> 定义了 <code>teacher</code> 属性，这样就可以直接通过 <code>course.teacher</code> 获取相应的用户记录。<code>Course</code> 类定义后，接着定义 <code>Lab</code> 类：</p><pre><code class="hljs python">In [<span class="hljs-number"><span class="hljs-number">89</span></span>]: <span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> <span class="hljs-title">Lab</span><span class="hljs-params">(Base)</span>:</span>
    ...:    __tablename__ = <span class="hljs-string"><span class="hljs-string">'lab'</span></span>
    ...:    id = Column(Integer, primary_key=<span class="hljs-literal"><span class="hljs-keyword">True</span></span>)
    ...:    name = Column(String(<span class="hljs-number"><span class="hljs-number">64</span></span>))
    ...:    course_id = Column(Integer, ForeignKey(<span class="hljs-string"><span class="hljs-string">'course.id'</span></span>))
    ...:    course = relationship(<span class="hljs-string"><span class="hljs-string">'Course'</span></span>, backref=<span class="hljs-string"><span class="hljs-string">'labs'</span></span>)
    ...:    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span><span class="hljs-params">(self)</span>:</span>
    ...:         <span class="hljs-keyword">return</span> <span class="hljs-string"><span class="hljs-string">'&lt;Lab(name=%s)&gt;'</span></span> % self.name
    ...:
</code></pre><p>以上代码定义了 <code>Lab</code> 类，需要注意的地方是定义 <code>course</code> 属性时，使用了 <code>relationship</code> 的 <code>backref</code> 参数，该参数使得可以在 <code>Course</code> 实例中，通过 <code>course.labs</code> 访问关联的所有实验记录。</p><p>定义 <code>Lab</code> 类以后，就可以通过以下命令在 MySQL 中创建相应的 <code>lab</code> 表：</p><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">In</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[90]</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Base</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.metadata</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.create_all</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">engine</span></span>)
</code></pre><p>然后通过 MySQL 客户可以看到，相应的表已经创建成功：</p><pre><code class="hljs mysql ruby">
<span class="hljs-section">mysql&gt; show tables;
+---------------------+</span>
<span class="hljs-section"><span class="hljs-params">| Tables_in_shiyanlou |</span>
+---------------------+</span>
<span class="hljs-params">| course              |</span>
<span class="hljs-params">| lab                 |</span>
<span class="hljs-section"><span class="hljs-params">| user                |</span>
+---------------------+</span>
<span class="hljs-number">3</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)

<span class="hljs-section">mysql&gt; describe lab;
+-----------+-------------+------+-----+---------+----------------+</span>
<span class="hljs-section"><span class="hljs-params">| Field     |</span> Type        <span class="hljs-params">| Null |</span> Key <span class="hljs-params">| Default |</span> Extra          <span class="hljs-params">|
+-----------+-------------+------+-----+---------+----------------+</span></span><span class="hljs-params">
|</span> id        <span class="hljs-params">| int(11)     |</span> NO   <span class="hljs-params">| PRI |</span> NULL    <span class="hljs-params">| auto</span><span class="hljs-emphasis"><span class="hljs-params">_increment |</span>
<span class="hljs-params">| name      |</span> varchar(<span class="hljs-number">64</span>) <span class="hljs-params">| YES  |</span>     <span class="hljs-params">| NULL    |</span>                <span class="hljs-params">|
|</span> course_</span>id <span class="hljs-params">| int(11)     |</span> YES  <span class="hljs-params">| MUL |</span> NULL    <span class="hljs-params">|                |</span>
<span class="hljs-code">+-----------+</span>-------------<span class="hljs-code">+------+</span>-----<span class="hljs-code">+---------+</span>----------------+
<span class="hljs-number">3</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)
</code></pre><h3 id="labdoc-header-12">简单的 CRUD 操作</h3>
<p>基于前面创建的 <code>User</code>, <code>Course</code> 和 <code>Lab</code> 类，我们进一步学习创建，查询，更新，删除操作。
有了 ORM 映射以后了，创建数据库记录就非常简单，比如想创建一个实验，该实验关联到前文插入的课程上，只需要创建 <code>Lab</code> 的实例就可以了：</p><pre><code class="hljs cs"><span class="hljs-keyword">In</span> [<span class="hljs-number">37</span>]: course = session.query(Course).first()

<span class="hljs-keyword">In</span> [<span class="hljs-number">38</span>]: lab1 = Lab(<span class="hljs-attribute">name</span>=<span class="hljs-string"><span class="hljs-string">'ORM 基础'</span></span>, <span class="hljs-attribute">course_id</span>=course.id)

<span class="hljs-keyword">In</span> [<span class="hljs-number">39</span>]: lab2 = Lab(<span class="hljs-attribute">name</span>=<span class="hljs-string"><span class="hljs-string">'关系数据库'</span></span>, <span class="hljs-attribute">course</span>=course)

<span class="hljs-keyword">In</span> [<span class="hljs-number">41</span>]: session.<span class="hljs-builtin-name"><span class="hljs-keyword">add</span></span>(lab1)

<span class="hljs-keyword">In</span> [<span class="hljs-number">42</span>]: session.<span class="hljs-builtin-name"><span class="hljs-keyword">add</span></span>(lab2)

<span class="hljs-keyword">In</span> [<span class="hljs-number">43</span>]: session.commit()

<span class="hljs-keyword">In</span> [<span class="hljs-number">44</span>]: course.labs
Out[<span class="hljs-number">44</span>]: [&lt;Lab(<span class="hljs-attribute">name</span>=关系数据库)&gt;, &lt;Lab(<span class="hljs-attribute">name</span>=ORM 基础)&gt;]
</code></pre><p>上面的代码中，首先查询出需要管理的课程对象，接着创建了两个实验，并通过 <code>session.commit()</code> 操作提交到了数据库中，在将数据变更提交到数据库中前，需要将数据通过 <code>session.add</code> 方法添加到 session 中。还可以看到，创建实验时，关联到课程有两种办法，一种是直接赋值给 <code>course_id</code>, 另外一种办法是赋值给定义的关系属性 <code>course</code>。当数据成功插入数据库后，就可以通过 <code>course.labs</code> 获取这两个实验。</p><p>MySQL 客户端中可以查询出 <code>lab</code> 表中成功的插入了两条数据：</p><pre><code class="hljs mysql ruby"><span class="hljs-section">mysql&gt; select * from lab;
+----+-----------------+-----------+</span>
<span class="hljs-section"><span class="hljs-params">| id |</span> name            <span class="hljs-params">| course_id |</span>
+----+-----------------+-----------+</span>
<span class="hljs-params">|  2 |</span> 关系数据库      <span class="hljs-params">|         2 |</span>
<span class="hljs-section"><span class="hljs-params">|  3 |</span> ORM 基础        <span class="hljs-params">|         2 |</span>
+----+-----------------+-----------+</span>
<span class="hljs-number">2</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)
</code></pre><p>更新操作也非常简单，只需要更新对象的属性，然后通过 <code>session.commit（）</code> 提交到数据库即可，下面的代码演示了如何更新课程名称：</p><pre><code class="hljs cs"><span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">58</span></span>]: course.<span class="hljs-keyword">name</span>
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">58</span></span>]: <span class="hljs-string"><span class="hljs-string">'Python 基础'</span></span>

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">59</span></span>]: lab1.course
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">59</span></span>]: &lt;Course(<span class="hljs-keyword">name</span>=Python 基础)&gt;

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">60</span></span>]: course.<span class="hljs-keyword">name</span> = <span class="hljs-string"><span class="hljs-string">'Python 数据分析'</span></span>

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">61</span></span>]: session.<span class="hljs-keyword">add</span>(course)

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">62</span></span>]: session.commit()

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">63</span></span>]: lab1.course
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">63</span></span>]: &lt;Course(<span class="hljs-keyword">name</span>=Python 数据分析)&gt;

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">64</span></span>]: session.query(Course).all()
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">64</span></span>]: [&lt;Course(<span class="hljs-keyword">name</span>=Python 数据分析)&gt;]
</code></pre><p>删除数据时通过 <code>session.delete</code> 方法删除相应的对象即可：</p><pre><code class="hljs css"><span class="hljs-selector-tag">In</span> <span class="hljs-selector-attr">[</span><span class="hljs-number"><span class="hljs-selector-attr">65</span></span><span class="hljs-selector-attr">]</span>: <span class="hljs-selector-tag">session</span><span class="hljs-selector-class">.delete</span>(<span class="hljs-selector-tag">lab1</span>)

<span class="hljs-selector-tag">In</span> <span class="hljs-selector-attr">[</span><span class="hljs-number"><span class="hljs-selector-attr">66</span></span><span class="hljs-selector-attr">]</span>: <span class="hljs-selector-tag">session</span><span class="hljs-selector-class">.commit</span>()

<span class="hljs-selector-tag">In</span> <span class="hljs-selector-attr">[</span><span class="hljs-number"><span class="hljs-selector-attr">67</span></span><span class="hljs-selector-attr">]</span>: <span class="hljs-selector-tag">course</span><span class="hljs-selector-class">.labs</span>
<span class="hljs-selector-tag">Out</span><span class="hljs-selector-attr">[</span><span class="hljs-number"><span class="hljs-selector-attr">67</span></span><span class="hljs-selector-attr">]</span>: <span class="hljs-meta"><span class="hljs-selector-attr">[&lt;Lab(name=关系数据库)&gt;]</span></span>
</code></pre><p>删除记录以后，通过课程实例获取到的实验数量同样减少。</p><p>可以看到有了 SQLAlchemy 以后，对于数据库的 CRUD 操作全部变成了相应的 Python 对象操作，非常方便。</p><h3 id="labdoc-header-13">1:1 和 M:M 的关系建立</h3>
<p>在关系数据库中，关系类型有三种：</p><ul>
<li>1:1，两张表中的数据项是一对一的关系，假设用户只有一项附属信息，这个时候用户表和附属信息表就是一对一的关系；</li>
<li>1:M，比如上文中课程和实验的关系，一个课程对应多个实验；</li>
<li>M:M，多对多的关系，比如课程和标签的关系，一个课程有多个标签，而一个标签可以关联到多个课程；</li>
</ul>
<p>我们已经知道 1:M 的关系创建方法，主要通过外键进行。其实 1:1 的关系也可以通过外键进行创建。通过以下代码创建 <code>UserInfo</code> 用户附属信息表：</p><pre><code class="hljs python"><span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">86</span></span>]: <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span><span class="hljs-params">(Base)</span>:</span>
    ...:     __tablename__ = <span class="hljs-string"><span class="hljs-string">'userinfo'</span></span>
    ...:     user_id = <span class="hljs-keyword">Column</span>(<span class="hljs-keyword">Integer</span>, ForeignKey(<span class="hljs-string"><span class="hljs-string">'user.id'</span></span>), primary_key=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)
    ...:     addr = <span class="hljs-keyword">Column</span>(<span class="hljs-keyword">String</span>(<span class="hljs-number"><span class="hljs-number">512</span></span>))
    ...:

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">87</span></span>]: Base.metadata.create_all(engine)
</code></pre><p>以上代码中，成功创建了 <code>UserInfo</code> 表，它和 <code>User</code> 表的关系就是 1:1 的关系，因为 <code>UserInfo</code> 表的主键和外键都是 <code>user_id</code>, 且依赖于 <code>User</code> 表的主键。</p><p>对于 M:M 多对多的关系，可以由两个 1:M 的关系构造出来。如果两张表对于同一张表（假如表名是 T）都是 1:M 的关系，那么就可以把 T 当做中间表，创建出两张表的多对多关系。比如课程表和标签表的关系，可以由以下代码创建：</p><pre><code class="hljs python">In [<span class="hljs-number"><span class="hljs-number">90</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sqlalchemy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Table, Text

In [<span class="hljs-number"><span class="hljs-number">91</span></span>]: course_tag = Table(<span class="hljs-string"><span class="hljs-string">'course_tag'</span></span>, Base.metadata,
    ...:     Column(<span class="hljs-string"><span class="hljs-string">'course_id'</span></span>, ForeignKey(<span class="hljs-string"><span class="hljs-string">'course.id'</span></span>), primary_key=<span class="hljs-literal"><span class="hljs-keyword">True</span></span>),
    ...:     Column(<span class="hljs-string"><span class="hljs-string">'tag_id'</span></span>, ForeignKey(<span class="hljs-string"><span class="hljs-string">'tag.id'</span></span>), primary_key=<span class="hljs-literal"><span class="hljs-keyword">True</span></span>)
    ...: )

In [<span class="hljs-number"><span class="hljs-number">92</span></span>]: <span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> <span class="hljs-title">Tag</span><span class="hljs-params">(Base)</span>:</span>
     ...:     __tablename__ = <span class="hljs-string"><span class="hljs-string">'tag'</span></span>
     ...:     id = Column(Integer, primary_key=<span class="hljs-literal"><span class="hljs-keyword">True</span></span>)
     ...:     name = Column(String(<span class="hljs-number"><span class="hljs-number">64</span></span>))
     ...:     courses = relationship(<span class="hljs-string"><span class="hljs-string">'Course'</span></span>,
     ...:                            secondary=course_tag,
     ...:                            backref=<span class="hljs-string"><span class="hljs-string">'tags'</span></span>)
     ...:     <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__repr__</span><span class="hljs-params">(self)</span>:</span>
     ...:         <span class="hljs-keyword">return</span> <span class="hljs-string"><span class="hljs-string">'&lt;Tag(name=%s)&gt;'</span></span> % self.name

In [<span class="hljs-number"><span class="hljs-number">93</span></span>]: Base.metadata.create_all(engine)  
</code></pre><ol>
<li><code>Base.metadata</code> 是 <code>sqlalchemy.schema.MetaData</code> 对象,表示所有 Table 对象集合, <code>create_all()</code> 会触发 <code>CREATE TABLE</code> 语句创建所有的表。</li>
<li><code>course_tag</code> 是双主键，双主键的目的就是为了约束避免出现重复的一对主键记录，大部分情况都是应用在这种多对多的中间表中。</li>
<li><code>secondary</code> 指的是中间表，<code>backref</code> 指向自己的这个表。</li>
<li><code>session</code> 内部的实现都是调用 engine 的各种接口，相当于 session 是 engine 的一个封装，比如 <code>session.commit</code> 的时候会先调用 <code>engine.connect()</code> 去连接数据库，再调用执行 sql 相关的接口。</li>
</ol>
<p>上面的代码中，首先通过 <code>Table</code> 类创建了一张中间表 <code>course_tag</code>，因为这张表不需要映射到任何 Python 对象上，所以直接创建了表。 可以看到 <code>Course</code>， <code>Tag</code> 表和 <code>course_tag</code> 表都是 1:M 的关系。通过 <code>course_tag</code> 这张中间表成功的建立了 M:M 的关系。还需要注意的是，<code>Tag</code> 表中定义了 <code>courses</code> 属性，该属性通过 <code>relationship</code> 函数的 <code>secondary</code> 参数告诉 SQLAlchemy 通过表 <code>course_tag</code> 关联到 <code>Course</code> 表的对象上。下面演示下多对多关系的 CRUD 操作：</p><pre><code class="hljs cs"><span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">126</span></span>]: session.close()
<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">130</span></span>]: course = session.query(Course).first()

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">131</span></span>]: course.tags
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">131</span></span>]: []

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">132</span></span>]: tag1 = Tag(<span class="hljs-keyword">name</span>=<span class="hljs-string"><span class="hljs-string">'tag_1'</span></span>)

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">133</span></span>]: tag2 = Tag(<span class="hljs-keyword">name</span>=<span class="hljs-string"><span class="hljs-string">'tag_2'</span></span>)

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">136</span></span>]: course.tags.append(tag1)

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">137</span></span>]: course.tags.append(tag2)

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">138</span></span>]: session.<span class="hljs-keyword">add</span>(course)

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">139</span></span>]: session.commit()

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">140</span></span>]: course.tags
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">140</span></span>]: [&lt;Tag(<span class="hljs-keyword">name</span>=tag_1)&gt;, &lt;Tag(<span class="hljs-keyword">name</span>=tag_2)&gt;]

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">141</span></span>]: engine.execute(<span class="hljs-string"><span class="hljs-string">'select * from tag'</span></span>).fetchall()
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">141</span></span>]: [(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'tag_1'</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'tag_2'</span></span>)]

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">142</span></span>]: engine.execute(<span class="hljs-string"><span class="hljs-string">'select * from course_tag'</span></span>).fetchall()
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">142</span></span>]: [(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)]
</code></pre><p>上面的代码中，通过 <code>course.tags.append(tag1)</code> 向课程中添加标签，就像操作 Python 列表一样方便，最后还通过 <code>engine.execute</code> 执行 SQL 查询验证了标签确实插入了数据库中，而且 <code>course_tag</code> 表中也生成了相应的关系记录。下面尝试向 <code>Tag</code>对象中添加课程：</p><pre><code class="hljs cs"><span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">153</span></span>]: teacher = session.query(User).filter(User.<span class="hljs-keyword">name</span>==<span class="hljs-string"><span class="hljs-string">'aiden'</span></span>).first()

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">154</span></span>]: course1 = Course(<span class="hljs-keyword">name</span>=<span class="hljs-string"><span class="hljs-string">'Linux 基础'</span></span>, teacher=teacher)

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">155</span></span>]: session.<span class="hljs-keyword">add</span>(course1)

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">156</span></span>]: session.commit()

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">157</span></span>]: tag1.courses
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">157</span></span>]: [&lt;Course(<span class="hljs-keyword">name</span>=Python 数据分析)&gt;]

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">159</span></span>]: tag1.courses.append(course1)

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">160</span></span>]: session.<span class="hljs-keyword">add</span>(tag1)

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">161</span></span>]: session.commit()

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">163</span></span>]: tag1.courses
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">163</span></span>]: [&lt;Course(<span class="hljs-keyword">name</span>=Python 数据分析)&gt;, &lt;Course(<span class="hljs-keyword">name</span>=Linux 基础)&gt;]

<span class="hljs-keyword">In</span> [<span class="hljs-number"><span class="hljs-number">164</span></span>]: engine.execute(<span class="hljs-string"><span class="hljs-string">'select * from course_tag'</span></span>).fetchall()
<span class="hljs-keyword">Out</span>[<span class="hljs-number"><span class="hljs-number">164</span></span>]: [(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)]
</code></pre><p>首先创建了另外一门课程 <code>course1</code>, 然后成功的将 <code>course1</code> 添加到了标签 <code>tag1</code> 中。</p><p>相信通过以上例子，你已经基本学会了 SQLAlchemy 中创建各种关系的方法。</p><h2 id="labdoc-header-14">总结</h2>
<p>本节实验主要讲解了 MySQL 和 SQLAlchemy 的基础知识，其中 MySQL 主要包含以下知识点：</p><ul>
<li>数据库，表的创建方式；</li>
<li>基本的 CRUD 操作；</li>
<li>基本约束的建立方式；</li>
</ul>
<p>SQLAlchemy 主要包含以下知识点：</p><ul>
<li>连接数据库的方式；</li>
<li>映射类（表）的定义方式；</li>
<li>通过 Python 对象进行 CRUD 操作；</li>
<li>常用关系的定义方式；</li>
</ul>
<p>本节实验涉及的代码比较多，但是请务必都实际写一遍，这样才能真正掌握本节内容。</p></div>


https://labfile.oss.aliyuncs.com/courses/923/week2_mp4/2-2-1-mac.mp4
https://labfile.oss.aliyuncs.com/courses/923/week2_mp4/2-2-2-mac.mp4
https://labfile.oss.aliyuncs.com/courses/923/week2_mp4/2-2-3-mac.mp4
